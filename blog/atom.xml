<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://doc.aurora.dev/blog</id>
    <title>Aurora Documentation Blog</title>
    <updated>2025-02-07T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://doc.aurora.dev/blog"/>
    <subtitle>Aurora Documentation Blog</subtitle>
    <icon>https://doc.aurora.dev/img/favicon.svg</icon>
    <rights>Copyright © 2025 AuroraLabs, Inc.</rights>
    <entry>
        <title type="html"><![CDATA[Safe Wallet and Aurora: multisigs for Bitcoin]]></title>
        <id>https://doc.aurora.dev/blog/safe-bitcoin-demo</id>
        <link href="https://doc.aurora.dev/blog/safe-bitcoin-demo"/>
        <updated>2025-02-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[By using NEAR Chain Signatures and Aurora we demonstrate how Safe Wallet could control Bitcoin account operations]]></summary>
        <content type="html"><![CDATA[<p>In this article, we will discuss how, by using <a href="https://doc.aurora.dev/crosschain/chain-signatures">Chain Signatures</a> on Aurora, a Safe Wallet could control Bitcoin accounts and their assets.</p>
<p>This is an example of how a virtual chain could be a runtime environment for another blockchain lacking native smart contracts. <a href="https://doc.aurora.dev/crosschain/chain-signatures">The idea</a> could generally be applied to any virtual chain and any accounts or contracts on it.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="acknowledgements">Acknowledgements<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#acknowledgements" class="hash-link" aria-label="Direct link to Acknowledgements" title="Direct link to Acknowledgements">​</a></h2>
<p>I want to say a big "Thank You" to the people helping me out while creating this demo:</p>
<ul>
<li>Michael Birch, for <a href="https://doc.aurora.dev/crosschain/xcc/aurora-to-near/introduction">XCC</a> and Chain Signatures consultations.</li>
<li>Oleksandr Anyshchenko, for writing the main part of the <a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a> contract and support with the demo.</li>
<li>Diego Figueroa, for debugging a smart contract with me.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="tldr">TL;DR<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#tldr" class="hash-link" aria-label="Direct link to TL;DR" title="Direct link to TL;DR">​</a></h2>
<p>If you don't like to read, you can just watch these videos below.</p>
<p>The first one explains the theory behind the demo and overall idea:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/XtwHOsxOljc?si=XZyYd8WTHdZuKnUW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<p>The second one demonstrates how everything could be executed in practice:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Lj5SiNlxkGU?si=Ihf7m9CzvvVp8CMN" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="what-problem-is-being-solved">What problem is being solved?<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#what-problem-is-being-solved" class="hash-link" aria-label="Direct link to What problem is being solved?" title="Direct link to What problem is being solved?">​</a></h2>
<p>Some blockchains lack smart contracts, such as Bitcoin, Ripple, etc.
Or have non-EVM architectures and no Solidity contracts available.
But you are an EVM dev who wants to build there. Also, you want to have a scalability of the NEAR Protocol at the tips of your hands.</p>
<p>Then <a href="https://docs.near.org/concepts/abstraction/chain-signatures" target="_blank" rel="noopener noreferrer">NEAR Chain Signatures</a> + a virtual chain, like Aurora, can resolve this problem for you!</p>
<p>I will demonstrate how it could be done by creating a Safe wallet on Aurora and controlling its derived Bitcoin address.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="the-demo-explained">The demo explained<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#the-demo-explained" class="hash-link" aria-label="Direct link to The demo explained" title="Direct link to The demo explained">​</a></h2>
<p>I wanted a Safe Wallet on Aurora to control the Bitcoin assets on the associated derived account.</p>
<p>To achieve this, we need two main steps:</p>
<ol>
<li>Sign a Bitcoin transaction with MPC service</li>
<li>Relay this transaction to Bitcoin Network</li>
</ol>
<p>To do this, two pieces of technology are combined:</p>
<ol>
<li><a href="https://doc.aurora.dev/crosschain/xcc/aurora-to-near/introduction">XCC</a>.</li>
<li><a href="https://docs.near.org/concepts/abstraction/chain-signatures" target="_blank" rel="noopener noreferrer">NEAR Chain Signatures</a> (<a href="https://docs.near.org/concepts/abstraction/chain-signatures" target="_blank" rel="noopener noreferrer">https://docs.near.org/concepts/abstraction/chain-signatures</a>) (MPC + utils to derive accounts, form transactions).</li>
</ol>
<p>This gives us an implementation of Chain Signatures on Aurora via a Solidity contract called <a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a>.</p>
<p>You can read more about it in the documentation about <a href="https://doc.aurora.dev/crosschain/chain-signatures">Chain Signatures on Virtual Chains</a> and the repo's <code>README.md</code> itself.</p>
<p>I believe that picture can convey the whole process in the best possible way, so here is it:</p>
<!-- -->
<img src="https://doc.aurora.dev/img/safe-btc/scheme-light.png" alt="Docusaurus themed image" class="themedComponent_zcmF themedComponent--light_PZnH"><img src="https://doc.aurora.dev/img/safe-btc/scheme-dark.png" alt="Docusaurus themed image" class="themedComponent_zcmF themedComponent--dark_g7nS">
<p>So, we have our Safe Wallet with two signers – Safe User 1 and Safe User 2 assigned to it. We assume Safe User 1 is doing most of the actions, and Safe User 2 just needs to confirm the transaction.</p>
<p>Let me repeat the steps from the image above in the text format here.
The first step is creating and signing the Bitcoin transaction:</p>
<ol>
<li>User 1 derives Safe account on Bitcoin with <a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#deriving-your-addresses-on-bitcoin" target="_blank" rel="noopener noreferrer">derive_accounts.js</a>.</li>
<li>Tops it up with some Bitcoin (could be done via <a href="https://app.near-intents.org/" target="_blank" rel="noopener noreferrer">Near Intents</a>)</li>
<li>Prepares unsigned transaction with <a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#sending-transactions-to-bitcoin" target="_blank" rel="noopener noreferrer">send_tx.js</a>.</li>
<li>Submits it to Safe via Transaction Builder as a call to the <a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a> contract and signs the proposal to execute it.</li>
<li>User 2 also signs the proposal.</li>
<li><code>sign</code> method is called on CS Signer.</li>
<li>XCC subbaccount of CS Signer calls the MPC contract on NEAR.</li>
<li>MPC contract propels <a href="https://explorer.mainnet.aurora.dev/tx/0xf5de2f24cd6d9f7d93e40df638c47bc07c25d014190da4f033a676ed96186b8e?tab=logs" target="_blank" rel="noopener noreferrer">the callback</a> back to EVM with signed data.</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_lH1X alert alert--secondary"><div class="admonitionHeading_SPjx"><span class="admonitionIcon_ghVV"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_RARr"><p>We already have <a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a> contracts deployed to both Aurora Mainnet and Testnet: <a href="https://explorer.mainnet.aurora.dev/address/0xF7607CD922804DaA9D54d21349Dd6F9467098dDE" target="_blank" rel="noopener noreferrer">Mainnet Signer</a>, <a href="https://explorer.testnet.aurora.dev/address/0x7e4F22F1eE20e01719ff1D986D116B04aBB2EE3f" target="_blank" rel="noopener noreferrer">Testnet Signer</a></p></div></div>
<p>And then second step - Relaying the transaction - is done:</p>
<ol>
<li>User 1 takes signed data</li>
<li>Puts <code>big_affine</code> and <code>scalar</code> value back into <a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#sending-transactions-to-bitcoin" target="_blank" rel="noopener noreferrer">send_tx.js</a>, whcih constructs a signed transaction with it.</li>
<li><a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#sending-transactions-to-bitcoin" target="_blank" rel="noopener noreferrer">send_tx.js</a> relays the transaction to Bitcoin network.</li>
<li>RPC executes it.</li>
<li>Token transfer happens on Bitcoin network.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="how-it-works">How it works<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h2>
<p>It is a pretty challenging task to explain everything in detail here.
Here is a list of docs and resources that explain all parts needed to understand the demo perfectly:</p>
<ul>
<li><a href="https://doc.aurora.dev/crosschain/xcc/aurora-to-near/introduction">XCC</a></li>
<li><a href="https://doc.aurora.dev/crosschain/chain-signatures">Chain Signatures on Virtual Chains</a> - fresh docs about how signing works on EVM side, it has integration instructions also.</li>
<li><a href="https://docs.near.org/concepts/abstraction/chain-signatures" target="_blank" rel="noopener noreferrer">NEAR Chain Signatures</a></li>
<li><a href="https://github.com/near-examples/near-multichain/" target="_blank" rel="noopener noreferrer">NEAR Multichain Examples</a></li>
</ul>
<p>I have created the next two repos here to make this demo happen:</p>
<ul>
<li><a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a> - Solidity contract to <code>sign</code> your payload on NEAR MPC from EVM.</li>
<li><a href="https://github.com/aurora-is-near/chain-signatures-js" target="_blank" rel="noopener noreferrer">Chain Signatures JS Lib</a> - some tools to derive accounts and relay the transaction taken from <a href="https://github.com/near-examples/near-multichain/" target="_blank" rel="noopener noreferrer">NEAR Multichain Examples</a></li>
</ul>
<p>Feel free to reach me out on <a href="https://discord.com/invite/WXfbGsSUbT" target="_blank" rel="noopener noreferrer">Discord</a>; just mention @slava there, if you will have any questions.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="chain-signatures-signer">Chain Signatures Signer<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#chain-signatures-signer" class="hash-link" aria-label="Direct link to Chain Signatures Signer" title="Direct link to Chain Signatures Signer">​</a></h3>
<p>What is the main thing this contract does?</p>
<ul>
<li>It calls the MPC service on NEAR and <a href="https://explorer.mainnet.aurora.dev/tx/0x019fbf6ee6aad1edf9c68ab6cc04b8eba16479a724a1d6a9c741c5d04849c3cd" target="_blank" rel="noopener noreferrer">signs your payload</a>.</li>
<li>Then it propagates <a href="https://explorer.mainnet.aurora.dev/tx/0xf5de2f24cd6d9f7d93e40df638c47bc07c25d014190da4f033a676ed96186b8e?tab=logs" target="_blank" rel="noopener noreferrer">the response</a> back to the EVM.</li>
</ul>
<p>It is done via the <code>sign</code> function call and receiving the response in the <code>signCallback</code> transaction.</p>
<h4 class="anchor anchorWithStickyNavbar_L_jL" id="sign-function">Sign function<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#sign-function" class="hash-link" aria-label="Direct link to Sign function" title="Direct link to Sign function">​</a></h4>
<p>To call <code>sign</code> you will need to provide:</p>
<ul>
<li><code>payload</code> - the data to be signed</li>
<li><code>version</code> - <code>key_version</code> from chain signatures, check NEAR docs. At the moment, it is just 0.</li>
<li><code>attachedNear</code> - the amount of wNEAR to attach to the NEAR call. Usually, 1yoctoNEAR is enough, so you should just enter 1.</li>
</ul>
<p>The code for the <code>sign</code> method looks like this:</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">uint256</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">uint128</span><span class="token plain"> attachedNear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> _data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hexStringToBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Payload must be 32 bytes"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// path is fixed here to make sure only msg.sender can use the derived </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// address via chain signature's of the xcc sub-account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addressToString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callSign </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"sign"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attachedNear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  SIGN_NEAR_GAS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callback </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">auroraCall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeWithSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signCallback</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">selector</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SIGN_CALLBACK_NEAR_GAS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        callSign</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The main moments to focus on are:</p>
<ul>
<li><strong>Ownership Preservation</strong>: The derivation path is equal to <code>addressToString(msg.sender);</code> which ensures that only the EOA or contract who is <code>msg.sender</code> can operate the derived account on other networks.</li>
<li><strong>Callback is optional</strong>: you can remove it and index the NEAR blockchain instead for the MPC response. It will save you some gas if you don't need the signed message back into your Solidity contracts.</li>
<li><strong>Gas for signature</strong>: <code>SIGN_NEAR_GAS</code> value can change in the future and be optimized. Right now, it is 50TGas.</li>
</ul>
<p>Here is <a href="https://explorer.mainnet.aurora.dev/tx/0x019fbf6ee6aad1edf9c68ab6cc04b8eba16479a724a1d6a9c741c5d04849c3cd" target="_blank" rel="noopener noreferrer">the transaction with <code>sign</code> call</a> in it.</p>
<h4 class="anchor anchorWithStickyNavbar_L_jL" id="sign-callback">Sign callback<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#sign-callback" class="hash-link" aria-label="Direct link to Sign callback" title="Direct link to Sign callback">​</a></h4>
<p>Function <code>signCallback</code> just propagates the MPC response back inside EVM and emits <code>SignedEvent</code>:</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">signCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onlyRole</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CALLBACK_ROLE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PromiseResult </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AuroraSdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">promiseResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> PromiseResultStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Successful</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">revert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"SignCallback failed"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">emit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SignedEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output will contain the <code>affine_point</code> and <code>scalar</code> to reconstruct the signature. You can take a look at the <a href="https://explorer.mainnet.aurora.dev/tx/0xf5de2f24cd6d9f7d93e40df638c47bc07c25d014190da4f033a676ed96186b8e?tab=logs" target="_blank" rel="noopener noreferrer">example of such transaction</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="chain-signatures-js-lib">Chain Signatures JS Lib<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#chain-signatures-js-lib" class="hash-link" aria-label="Direct link to Chain Signatures JS Lib" title="Direct link to Chain Signatures JS Lib">​</a></h3>
<p>This lib is just a bunch of Node JS scripts to help you with NEAR Chain Signatures:</p>
<ul>
<li>Allows to derive BTC addresses on Mainnet and Testnet</li>
<li>Create transactions for BTC transfers</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_L_jL" id="deriving-your-addresses-on-bitcoin">Deriving your addresses on Bitcoin<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#deriving-your-addresses-on-bitcoin" class="hash-link" aria-label="Direct link to Deriving your addresses on Bitcoin" title="Direct link to Deriving your addresses on Bitcoin">​</a></h4>
<p>Just go to <code>src/derive_account.js</code> and enter if you want to use mainnet or testnet, your NEAR address, and derivation path:</p>
<div class="language-js codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-js codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">BTC</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Bitcoin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'mainnet'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;- mainnet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> account </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'f7607cd922804daa9d54d21349dd6f9467098dde.aurora'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;- XCC subaccount address, but you can use yours .near account instead</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0x70ebe9fbc4e9920b07a1f043b2bede8fc2e09504'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;-- derivation path, could be any seed, like 'bitcoin-1', 'bitcoin-2', etc. But in Safe BTC Demo we need it to correspond to the address on Aurora.</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you can execute it:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">node src/derive_account.js</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You will get your account primary data, balance and UTXOs.
Read more about <a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#deriving-your-addresses-on-bitcoin" target="_blank" rel="noopener noreferrer">account derivation</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_L_jL" id="sending-the-transaction">Sending the transaction<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#sending-the-transaction" class="hash-link" aria-label="Direct link to Sending the transaction" title="Direct link to Sending the transaction">​</a></h4>
<p>Now, you can take the derived account data and use it inside <code>src/send_tx.js</code> script.</p>
<p>It was designed to execute a BTC transfer between two accounts.</p>
<p>Enter your data into some struct like:</p>
<div class="language-js codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-js codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> safe_account </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">address</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bc1qunau3q49dqewseky6nl9dqmq5fjsjfxmlkht8k'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">publicKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'02ac2ac40a97879c728d0f9830996793b130aa5be0cf41f796ac7afcf739a72649'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">nearAccount</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'f7607cd922804daa9d54d21349dd6f9467098dde.aurora'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'0x70ebe9fbc4e9920b07a1f043b2bede8fc2e09504'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should also prepare the data for BTC transfer in these variables (around line 40):</p>
<div class="language-js codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-js codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sats </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;-- amount of Satoshis to transfer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> safe_account</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;-- derivation path of source account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> pkey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> safe_account</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publicKey</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;-- pubkey of source account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> toAddress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'14secnpokXzrjRa3fEwcJ1RQKusCp3kTUA'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// &lt;-- destination address</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, you're ready to send the transaction:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">node src/send_tx.js </span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After that, you will need:</p>
<ol>
<li>To sign it via a call to <a href="https://github.com/aurora-is-near/chain-signatures-signer" target="_blank" rel="noopener noreferrer">Chain Signatures Signer</a> contract.</li>
<li>To put the signed data back into your terminal.</li>
</ol>
<p>Then, a transaction will be relayed and executed on the Bitcoin network.</p>
<p>Read more about <a href="https://github.com/aurora-is-near/chain-signatures-js?tab=readme-ov-file#sending-transactions-to-bitcoin" target="_blank" rel="noopener noreferrer">relaying transactions</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="outro">Outro<a href="https://doc.aurora.dev/blog/safe-bitcoin-demo#outro" class="hash-link" aria-label="Direct link to Outro" title="Direct link to Outro">​</a></h2>
<p>That is it! Thank you for reading the article! I hope you liked it and learned a lot today!</p>
<p>Happy developing on virtual chains!</p>
<p>If you have any questions or suggestions, please visit our <a href="https://discord.com/invite/WXfbGsSUbT" target="_blank" rel="noopener noreferrer">Discord Community</a>!</p>]]></content>
        <author>
            <name>Slava Karkunov</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to bridge liquidity to Aurora?]]></title>
        <id>https://doc.aurora.dev/blog/how-to-bridge-liquidity-to-aurora</id>
        <link href="https://doc.aurora.dev/blog/how-to-bridge-liquidity-to-aurora"/>
        <updated>2024-05-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We will focus on stablecoins, explain their types on Aurora, and take a look at how to bridge them in different ways from other ecosystems]]></summary>
        <content type="html"><![CDATA[<p>In this article, we will discuss how to bridge liquidity to Aurora in the most convenient way. We will focus on stablecoins, explain why we have four types of these on Aurora, and take a look at how to bridge them in different ways. Note that this whole bridging process also applies to the ERC-20 tokens.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="the-global-picture--what-stables-do-we-have">The global picture – What stables do we have?<a href="https://doc.aurora.dev/blog/how-to-bridge-liquidity-to-aurora#the-global-picture--what-stables-do-we-have" class="hash-link" aria-label="Direct link to The global picture – What stables do we have?" title="Direct link to The global picture – What stables do we have?">​</a></h2>
<p>First, let’s mention three main actors here: Ethereum, Near, and Aurora blockchains. Second, we will consider the two most popular stables, USDC and USDT. To connect the ecosystem, we will use the Rainbow Bridge.<br>
<br>
<!-- -->Let’s take a look at how USDC and USDT tokens are bridged via Rainbow Bridge from Ethereum to Near:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1716383440-screenshot-2024-05-21-at-11-51-56.png" alt="" class="img__pfF"></p>
<p>As you can see, Near has the corresponding bridged versions of Ethereum’s tokens: USDC.e and USDT.e (in green), as well as the Near native <a href="https://nearblocks.io/address/17208628f84f5d6ad33f0da3bbbeb27ffcb398eac501a31bd6ad2011e36133a1" target="_blank" rel="noopener noreferrer"><em>USDC</em></a> and <a href="https://nearblocks.io/address/usdt.tether-token.near" target="_blank" rel="noopener noreferrer"><em>USDT</em></a> (in blue).</p>
<p>This is needed to separate the bridged liquidity from the native one on the Near blockchain. You may also have heard about such tokens being wrapped. All these versions are interchangeable using <a href="https://app.ref.finance/#a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48.factory.bridge.near%7C17208628f84f5d6ad33f0da3bbbeb27ffcb398eac501a31bd6ad2011e36133a1" target="_blank" rel="noopener noreferrer"><em>ref.finance,</em></a> on Near Protocol, as depicted by a green arrow in the image.</p>
<p>A similar story repeats with Aurora by bridging tokens from Ethereum and Near via Rainbow Bridge. So we’re getting the next picture:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1716383465-screenshot-2024-05-21-at-11-53-42.png" alt="" class="img__pfF"></p>
<p>That is why, on Aurora, we have 4 different tokens representing stables. USDC and USDT tokens are the wrapped analog for the Near native tokens. And USDC.e and USDT.e – for the Ethereum tokens. All these versions are interchangeable by using <a href="https://aurora.plus/swap" target="_blank" rel="noopener noreferrer"><em>Aurora+ Swap</em></a> feature supported by 1inch.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="how-to-transfer-liquidity-to-aurora">How to transfer liquidity to Aurora?<a href="https://doc.aurora.dev/blog/how-to-bridge-liquidity-to-aurora#how-to-transfer-liquidity-to-aurora" class="hash-link" aria-label="Direct link to How to transfer liquidity to Aurora?" title="Direct link to How to transfer liquidity to Aurora?">​</a></h2>
<p>As you have seen in the picture above, the most natural way to transfer tokens from Ethereum or Near is to use the <a href="https://rainbowbridge.app/" target="_blank" rel="noopener noreferrer"><em>Rainbow Bridge</em></a>. But we will talk about other variants too. Here is a picture summarizing the most popular ones:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1716383517-screenshot-2024-05-21-at-11-16-27.png" alt="" class="img__pfF"></p>
<p>If you have tokens on CEX that support Near, you can use <a href="https://doc.aurora.dev/launch-chain/forwarder/introduction" target="_blank" rel="noopener noreferrer">Forwarder</a>, which allows you to transfer them from CEX to your Aurora address. See Binance instructions <a href="https://doc.aurora.dev/launch-chain/forwarder/how-to-use/binance" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>For any other EVMs, you can use the <a href="https://stargate.finance/" target="_blank" rel="noopener noreferrer">Stargate</a> (coming soon) or <a href="https://meson.fi/" target="_blank" rel="noopener noreferrer">Meson</a> bridges. Stargate supports the Near Native USDC pool on Aurora. You can always <a href="https://aurora.plus/swap" target="_blank" rel="noopener noreferrer"><em>swap you tokens on Aurora+</em></a>, after bridging.<br>
<br>
<!-- -->That is it! Thank you for reading us!<br>
<!-- -->If you have any questions or suggestions, please visit our <a href="https://discord.com/invite/WXfbGsSUbT" target="_blank" rel="noopener noreferrer">Discord Community</a>!</p>]]></content>
        <author>
            <name>Slava Karkunov</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to get your tokens from Bastion contracts?]]></title>
        <id>https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract</id>
        <link href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract"/>
        <updated>2024-05-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In this article, you will learn how you can retrieve the stables from Bastion by using Aurora Explorer to call its smart contracts]]></summary>
        <content type="html"><![CDATA[<p>Recently, we became aware of this issue and the lack of a way to do it in the Bastion UI, so we decided to create a tutorial for everyone to use independently. Big thanks to the people in the community who helped me create and test this tutorial and provided invaluable insights and feedback!</p>
<p>To formulate the problem more precisely, a user has some <code>cUSDCcUSDTLP</code> tokens and wants to convert these back to stables. The Bastion project's UI doesn't allow this today, so the only way is to call smart contracts directly.</p>
<p>We will go through the next steps:</p>
<ul>
<li>What contracts should we call?</li>
<li>What method should we call, and how?</li>
<li>How to convert <code>cUSDC</code> and <code>cUSDT</code> into regular stables?</li>
</ul>
<p>We will use the most convenient way for users to interact with smart contracts—the Explorer. However, devs can always write a script to perform the steps described in this article with Ethers or Web3.js.</p>
<p>Let's go!</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="what-contracts">What contracts?<a href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract#what-contracts" class="hash-link" aria-label="Direct link to What contracts?" title="Direct link to What contracts?">​</a></h2>
<p>The main actor of this article will be <a href="https://explorer.aurora.dev/address/0x6287e912a9Ccd4D5874aE15d3c89556b2a05f080?tab=write_contract" target="_blank" rel="noopener noreferrer"><code>SwapFlashLoan</code> contract</a>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715902943-screenshot-2024-05-17-at-00-39-24.png" alt="" class="img__pfF"></p>
<p>The plan is:</p>
<ol>
<li>Approve <a href="https://explorer.aurora.dev/address/0x0039f0641156cac478b0DebAb086D78B66a69a01?tab=write_proxy" target="_blank" rel="noopener noreferrer">cUSDCcUSDTLP token</a> to be used by the <code>SwapFlashLoan</code> contract.</li>
<li>Get cUSDC and cUSDT from <code>SwapFlashLoan</code>.</li>
<li>Redeem <a href="https://explorer.aurora.dev/token/0xe5308dc623101508952948b141fD9eaBd3337D99" target="_blank" rel="noopener noreferrer">cUSDC</a> and <a href="https://explorer.mainnet.aurora.dev/address/0x845E15A441CFC1871B7AC610b0E922019BaD9826" target="_blank" rel="noopener noreferrer">cUSDT</a> from their contracts to get stables.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="approve-cusdccusdtlp">Approve cUSDCcUSDTLP<a href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract#approve-cusdccusdtlp" class="hash-link" aria-label="Direct link to Approve cUSDCcUSDTLP" title="Direct link to Approve cUSDCcUSDTLP">​</a></h2>
<p>Let's start with connecting your wallet. To do this, please open <a href="https://explorer.aurora.dev/address/0x0039f0641156cac478b0DebAb086D78B66a69a01?tab=write_proxy" target="_blank" rel="noopener noreferrer">cUSDCcUSDTLP token contract</a> and click Contract -&gt; Write Contract -&gt; Connect Wallet:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715948365-screenshot-2024-05-17-at-13-19-16.png" alt="" class="img__pfF"></p>
<p>Then you will see the next popup to connect your wallet:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715903570-screenshot-2024-05-17-at-00-52-39.png" alt="" class="img__pfF"></p>
<p>We recommend using <a href="https://auroracloud.dev/pass" target="_blank" rel="noopener noreferrer">the Aurora Pass wallet</a>, which you can connect via the Wallet Connect option above and a QR code. It offers 50 free transactions a month on the Aurora blockchain and is a very user-friendly mobile wallet.</p>
<p>After connecting it, we're ready to move further.<br>
<br>
<!-- -->If you scroll down, you will see the contract methods, and here is the one we need – <code>approve</code> and enter the arguments there with <code>spender</code> being the <code>swapFlashLoan</code> contract address and <code>amount</code> equal to the number of tokens you want to get back (probably all you have right now):</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715948641-screenshot-2024-05-17-at-13-22-10.png" alt="" class="img__pfF"></p>
<p>Now, we're ready to execute the transaction, just click the "Write" button on the right and confirm it in your wallet!</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="get-cusdc-and-cusdt">Get cUSDC and cUSDT<a href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract#get-cusdc-and-cusdt" class="hash-link" aria-label="Direct link to Get cUSDC and cUSDT" title="Direct link to Get cUSDC and cUSDT">​</a></h2>
<p>Let's open now the <a href="https://explorer.aurora.dev/address/0x6287e912a9Ccd4D5874aE15d3c89556b2a05f080?tab=write_contract" target="_blank" rel="noopener noreferrer"><code>SwapFlashLoan</code> contract</a>. Go to the Contract -&gt; Write Contract tab. If you scroll down, you will see the contract methods, and here is the one we need – <code>removeLiquidity</code>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715903828-screenshot-2024-05-17-at-00-56-14.png" alt="" class="img__pfF"></p>
<p>We're unsure about the arguments here yet, so let's find out what values we should use. To do this, we will look at one such transaction, which has already been executed by someone. We need to find it in history. So here is <a href="https://explorer.aurora.dev/tx/0x0b079aee0e1feae4c10e127a5535877baee23567f22bc5293a5f885ba8d249f9" target="_blank" rel="noopener noreferrer">one</a>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715903950-screenshot-2024-05-17-at-00-58-43.png" alt="" class="img__pfF"></p>
<p>You can see what exactly has happened here during the execution in terms of the token transfers:</p>
<ul>
<li><code>cUSDCcUSDTLP</code> tokens were burned</li>
<li><code>cUSDT</code> and <code>cUSDC</code> tokens were transferred to the caller</li>
</ul>
<p>Now, let's scroll down a bit and click on "View details" link at the left bottom of the page, you will see the arguments of the method used there:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715904026-screenshot-2024-05-17-at-00-58-57.png" alt="" class="img__pfF"></p>
<p>We can conclude by looking at the both screenshots above that:</p>
<ol>
<li><code>amount</code> argument is equal to your <code>cUSDCcUSDTLP</code> tokens amount with 18 decimals added. E.g. in this case, the user has 2021.941835489438, so the correct value should be 2021294184354893800000. You can use <a href="https://www.eth-to-wei.com/" target="_blank" rel="noopener noreferrer">this tool</a> to convert your values.</li>
<li><code>deadline</code> is your time now, with 20 minutes added to it in a timestamp format. You can use <a href="https://www.epochconverter.com/" target="_blank" rel="noopener noreferrer">the EpochConverter</a> tool to get the correct value. Just add 20 minutes to the datetime there and copy-paste the timestamp value.</li>
<li>The first value in <code>minAmounts</code> corresponds to the <code>cUSDT</code> token amount transferred back, and the second one is for the <code>cUSDC</code>. They have 8 decimals, and if you sum them up, you will get your amount of <code>cUSDCcUSDTLP</code> tokens. So you can just enter any values which in sum give you a value smaller or equal to the <code>amount</code>.</li>
</ol>
<p>We're ready to execute the method now. Just enter the correct arguments to your Explorer tab, it should look like this:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715907308-screenshot-2024-05-17-at-01-54-36.png" alt="" class="img__pfF"></p>
<p>After that, just click the "Write" button and confirm the transaction in your wallet.<br>
<!-- -->That is it! Now you got back your <code>cUSDC</code> and <code>cUSDT</code> tokens.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="how-to-convert-ctokens-to-stables">How to convert cTokens to stables?<a href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract#how-to-convert-ctokens-to-stables" class="hash-link" aria-label="Direct link to How to convert cTokens to stables?" title="Direct link to How to convert cTokens to stables?">​</a></h2>
<p>To do this, we will need to point our attention to these contracts:</p>
<ul>
<li>cUSDT: <a href="https://explorer.mainnet.aurora.dev/address/0x845E15A441CFC1871B7AC610b0E922019BaD9826" target="_blank" rel="noopener noreferrer">0x845E15A441CFC1871B7AC610b0E922019BaD9826</a></li>
<li>cUSDC: <a href="https://explorer.aurora.dev/token/0xe5308dc623101508952948b141fD9eaBd3337D99" target="_blank" rel="noopener noreferrer">0xe5308dc623101508952948b141fD9eaBd3337D99</a></li>
</ul>
<p>For both of them, the process will look the same, so let's just talk about <code>cUSDT</code> case. To unwrap you need to call this method – `redeem`:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715907708-screenshot-2024-05-17-at-02-01-35.png" alt="" class="img__pfF"></p>
<p>It has only one argument, which is the amount of tokens to unwrap with 8 decimals added to it. So, for <a href="https://explorer.aurora.dev/tx/0x0b079aee0e1feae4c10e127a5535877baee23567f22bc5293a5f885ba8d249f9" target="_blank" rel="noopener noreferrer">the transaction from the previous section</a>, it should be 167994638559. It is the amount of the <code>cUSDT</code> tokens you have received after your <code>removeLiquidity</code> call.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="final-thoughts">Final thoughts<a href="https://doc.aurora.dev/blog/hot-to-get-your-tokens-from-bastion-contract#final-thoughts" class="hash-link" aria-label="Direct link to Final thoughts" title="Direct link to Final thoughts">​</a></h2>
<p>That is it – you have successfully got your <code>cUSDCcUSDTLP</code> tokens converted back to stables. If you need any help or have a similar issue, please come <a href="https://discord.com/invite/dEFJBz8HQV" target="_blank" rel="noopener noreferrer">to our Discord</a>, and we will help you! Thank you for reading!\</p>]]></content>
        <author>
            <name>Slava Karkunov</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Managing Aurora's Validator staking with 'near-cli-rs']]></title>
        <id>https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs</id>
        <link href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs"/>
        <updated>2024-05-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Let's learn how to manage your staking with Near validators and claim your Aurora validator's rewards by using 'near-cli-rs']]></summary>
        <content type="html"><![CDATA[<p>In this article, we will discuss how to manage your staking on the Aurora Validator. To recap quickly, Aurora is an EVM-compatible blockchain running as an L2 on the Near Protocol. In the heart of it is an Aurora Engine smart contract. That is why every transaction on Aurora is relayed to the Near and has the corresponding Near transaction. You can read more about this <a href="https://doc.aurora.dev/blog/convert-aurora-transaction-into-near-s-one"><em>here</em></a>. That is why Aurora doesn’t have its own validators – we’re just re-using the Near ones.</p>
<p>In January 2023, we re-launched <a href="https://aurora.dev/blog/aurora-relaunches-its-validator" target="_blank" rel="noopener noreferrer"><em>our validator</em></a> with a new address, <a href="https://app.mynearwallet.com/staking/aurora.pool.near" target="_blank" rel="noopener noreferrer"><em>aurora.pool.near</em></a>. What is curious about it is that it gives you the rewards in AURORA tokens directly on the Near network.</p>
<p>Recently, the <a href="https://near.org/blog/embracing-decentralization-whats-next-for-the-near-wallet" target="_blank" rel="noopener noreferrer"><em>Near Wallet was deprecated</em></a> on the 1st of January, 2024. And that has driven users to other wallets. Unfortunately, many of these don’t support staking capabilities, especially with the non-standard validator as `aurora.pool.near` is.</p>
<p>So, based on the recent support experience, we have decided to publish a guide on how to use your terminal on your laptop or PC to manage your staking on the Aurora’s Validator. Let’s look into the details now!</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="installing-near-cli-rs">Installing `near-cli-rs`<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#installing-near-cli-rs" class="hash-link" aria-label="Direct link to Installing `near-cli-rs`" title="Direct link to Installing `near-cli-rs`">​</a></h2>
<p>Near CLI is your human-friendly companion that helps to interact with Near Protocol from the terminal right away. There are multiple ways to install it, see <a href="https://github.com/near/near-cli-rs?tab=readme-ov-file#install" target="_blank" rel="noopener noreferrer"><em>here</em></a>. I am using Mac, so I will choose the first option and execute in my Terminal:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">curl --proto '=https' --tlsv1.2 -LsSf https://github.com/near/near-cli-rs/releases/latest/download/near-cli-rs-installer.sh | sh </span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also run it as an npm package:</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">npx near-cli-rs </span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After installation, if you execute <code>near</code> command you should be able to see this screen:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714679129-screenshot-2024-05-02-at-20-45-17.png" alt="" class="img__pfF"></p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="connecting-your-account">Connecting your account<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#connecting-your-account" class="hash-link" aria-label="Direct link to Connecting your account" title="Direct link to Connecting your account">​</a></h2>
<p>Now, let's connect your account to the near-cli-rs. To do this, execute the near command and choose the account option, which you've seen in the previous screenshot above, using the <code>Enter</code> key.</p>
<p>You will see the next screen saying <code>What do you want to do with an account?</code>. Choose the <code>import-account</code> option there and press <code>Enter</code>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714679473-screenshot-2024-04-26-at-12-12-20.png" alt="" class="img__pfF"></p>
<p>You will see a screen with different import options:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714679597-screenshot-2024-05-02-at-20-52-57.png" alt="" class="img__pfF"></p>
<p>Choose one that fits you! I will try to use <code>using-web-wallet</code> option. The browser window with <a href="https://app.mynearwallet.com/" target="_blank" rel="noopener noreferrer">https://app.mynearwallet.com/</a> will be opened, and you will see a popup asking for your permission to connect:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714679775-screenshot-2024-04-26-at-12-13-22.png" alt="" class="img__pfF"></p>
<p>Click the <code>Connect</code> button to approve. After that, you will need to confirm this choice by typing your full account name into the popup:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714680087-screenshot-2024-05-02-at-20-59-05.png" alt="" class="img__pfF"></p>
<p>Then, you will get the next alert about successful authorization:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714680117-screenshot-2024-05-02-at-20-59-31.png" alt="" class="img__pfF"></p>
<p>Now, you can go back to your terminal window, and you will see a message asking you to enter your account name again:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714680166-screenshot-2024-05-02-at-21-00-07.png" alt="" class="img__pfF"></p>
<p>Enter it there and press <code>Enter</code>. After that, choose a keychain to store your keys. I am choosing the first option there:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714679837-screenshot-2024-04-26-at-12-14-36.png" alt="" class="img__pfF"></p>
<p>You will get the final message that `... access key is saved in the keychain` and a console command that can replace this manual process of choosing different options in the future:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714680238-screenshot-2024-05-02-at-21-00-41.png" alt="" class="img__pfF"></p>
<p>So, all of the things we did here could be achieved also with this command:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near account import-account using-web-wallet network-config mainnet</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That is great! As you can see, <code>near-cli-rs</code> is teaching you the terminal commands automatically while exploring it!<br>
<br>
<!-- -->You have added your Near account to <code>near-cli-rs</code>, and it is now ready to be used.<br>
<!-- -->Let's try it to stake some tokens on the Aurora Validator!</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="staking-tokens">Staking tokens<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#staking-tokens" class="hash-link" aria-label="Direct link to Staking tokens" title="Direct link to Staking tokens">​</a></h2>
<p>TLDR: to stake your tokens, you need to use the next command:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near staking delegation karkunow.near \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     deposit-and-stake '1 NEAR' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     aurora.pool.near network-config mainnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sign-with-keychain send</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let's review the rest of the section to learn the details about how it works with <code>near-cli</code>.<br>
<br>
<!-- -->First, make sure you know what validator you will use to stake. You can check the list of validators with this command:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near staking validator-list network-config mainnet</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I, of course, will use <code>aurora.pool.near</code> for this demo.</p>
<p>To stake your tokens, start with executing the <code>near</code> command and choosing the <code>staking</code> option from the list:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714681089-screenshot-2024-05-02-at-21-14-10.png" alt="" class="img__pfF"></p>
<p>Now, choose <code>delegation</code>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714681106-screenshot-2024-05-02-at-21-14-23.png" alt="" class="img__pfF"></p>
<p>And type your Near account into the console and press Enter. In my case, I have it already listed, so I will just choose mine from the list:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714681129-screenshot-2024-05-02-at-21-14-38.png" alt="" class="img__pfF"></p>
<p>After that, you need to choose <code>deposit-and-stake</code> (not just <code>stake</code> or <code>stake-all</code>, these options won't work if your tokens were not deposited to the validator yet):</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715217828-screenshot-2024-05-09-at-02-19-05.png" alt="" class="img__pfF"></p>
<p>Then, enter the amount of NEAR tokens to be staked, I am entering 1NEAR for the purpose of this demo:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218002-screenshot-2024-05-09-at-02-15-57.png" alt="" class="img__pfF"></p>
<p>Now, type in your validator address or choose from the list (you can use the <code>tab</code> key to autocomplete):</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218061-screenshot-2024-05-09-at-02-16-28.png" alt="" class="img__pfF"></p>
<p>Choose the network now, I will opt for the <code>mainnet</code>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218288-screenshot-2024-05-09-at-02-16-56.png" alt="" class="img__pfF"></p>
<p>After this, you will see your transaction formed and ready to be signed. By default, I am signing it with my keychain:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218347-screenshot-2024-05-09-at-02-17-12.png" alt="" class="img__pfF"></p>
<p>Now, you can <code>send</code> the transaction and execute it:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218434-screenshot-2024-05-09-at-02-17-47.png" alt="" class="img__pfF"></p>
<p>You will see the transaction ID and a link to the Explorer after the successful execution:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715218479-screenshot-2024-05-09-at-02-19-35.png" alt="" class="img__pfF"></p>
<p>We can visit the Explorer link to see the details of the transaction:</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="unstaking-tokens">Unstaking tokens<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#unstaking-tokens" class="hash-link" aria-label="Direct link to Unstaking tokens" title="Direct link to Unstaking tokens">​</a></h2>
<p>TLDR: You just need to use the next command, which is really similar to the one used for staking:</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near staking delegation karkunow.near \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     unstake-all \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     aurora.pool.near network-config mainnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sign-with-keychain send</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you don't want to unstake all the funds, just use the <code>unstake</code> option and enter the amount of NEAR tokens you want to get back.</p>
<p>Now, let's go through a few screenshots to understand better how I got this command from the <code>near-cli-rs</code>. As we have learned from the previous section, to manage our staking activities, we just execute:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near staking delegation [your account here](your account here)</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, if you want to unstake your tokens – just choose the <code>unstake-all</code> or <code>unstake</code> option from the list:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715219903-screenshot-2024-05-09-at-02-53-21.png" alt="" class="img__pfF"></p>
<p>After that, you will be guided through the same screens as for the staking to enter the amount, validator address, network config (mainnet or testnet), and then – sign and send it. After the execution, you will see:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715219915-screenshot-2024-05-09-at-02-52-57.png" alt="" class="img__pfF"></p>
<p>Exactly the same command will be formed by <code>near-cli-rs</code> after that process. So now, you can use this shortcut instead.<br>
<br>
<!-- -->After unstaking, you will need to wait for the 4 epochs on Near blockchain to pass, which will take around 50-60 hours of time. And then, you will be ready to withdraw them and the associated rewards. The rewards will be automatically unlocked together with the unstaked tokens.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="withdrawing-tokens">Withdrawing tokens<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#withdrawing-tokens" class="hash-link" aria-label="Direct link to Withdrawing tokens" title="Direct link to Withdrawing tokens">​</a></h2>
<p>I won't go into details with the screenshots here. Now, we're ready just to use the commands.</p>
<p>So, to withdraw your tokens and rewards, you need to execute this:</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near staking delegation karkunow.near \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     withdraw-all \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     aurora.pool.near network-config mainnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sign-with-keychain send</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you don't want to withdraw all the funds, just use `withdraw` and enter the amount of NEAR tokens you want to withdraw.</p>
<p>After the execution, you will see:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1714681248-screenshot-2024-05-02-at-21-17-51.png" alt="" class="img__pfF"></p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="claiming-on-auroras-validator">Claiming on Aurora's validator<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#claiming-on-auroras-validator" class="hash-link" aria-label="Direct link to Claiming on Aurora's validator" title="Direct link to Claiming on Aurora's validator">​</a></h2>
<p>Aurora's validator allows you to farm the AURORA tokens instead of NEAR by staking NEAR on it. It is based <a href="https://github.com/referencedev/staking-farm/" target="_blank" rel="noopener noreferrer">on this smart contract</a>. That is the reason why you need to use another way to claim these rewards in AURORA tokens. Can we do it with <code>near-cli-rs</code>? Yes! Let's see how it is done.<br>
<br>
<!-- -->I will use two variables to track the staking pool and account:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">export STAKINGCONTRACT=aurora.pool.near &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export MYACCOUNT=karkunow.near</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To track how much tokens you have right now in staking you should execute:</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near contract call-function as-read-only aurora.pool.near \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     'get_unclaimed_reward' json-args \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     '{"account_id":"'${MYACCOUNT}'", "farm_id":0}' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      network-config mainnet now</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You will see the something similar to the next screen:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715334843-screenshot-2024-05-10-at-10-25-15.png" alt="" class="img__pfF"></p>
<p>The value will be in Wei, so you need to convert it to get the real value of 0.0032 AURORA by multiplying it with 10^-18.</p>
<p>To claim your rewards you need to call the <code>claim</code> method on <code>aurora.pool.near</code> contract:</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">near contract call-function as-transaction aurora.pool.near \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     'claim' json-args \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     '{"account_id": "'${MYACCOUNT}'", \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       "token_id": "aaaaaa20d9e0e2461697782ef11675f668207961.factory.bridge.near"}' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     prepaid-gas '100.0 Tgas' attached-deposit '1 yoctoNEAR' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sign-as karkunow.near /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     network-config mainnet /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sign-with-keychain / </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     send</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We're passing the account and NEP-141 AURORA token address to the contract's <code>claim</code> method. Also we attach 100TGas of gas and deposit 1 yoctoNear to it.</p>
<p>After the execution, you will get the transaction hash, which you can now track in the explorer:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1715335148-screenshot-2024-05-10-at-10-58-39.png" alt="" class="img__pfF"></p>
<p>That is it! You claimed your rewards from the Aurora Validator.</p>
<p>If you want to dive deeper, you can read more docs about the <code>aurora.pool.near</code> methods <a href="https://github.com/referencedev/staking-farm/blob/master/HowTo.md" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="final-thoughts">Final thoughts<a href="https://doc.aurora.dev/blog/managing-aurora-s-validator-staking-with-near-cli-rs#final-thoughts" class="hash-link" aria-label="Direct link to Final thoughts" title="Direct link to Final thoughts">​</a></h2>
<p>Thank you for reading the article! We have learned a lot today!<br>
<!-- -->We hope that <code>near-cli-rs</code> will be an indispensable tool for you while working with the Near ecosystem and that it will make it easier for you to interact with the blockchain.<br>
<!-- -->See you in the next articles!</p>]]></content>
        <author>
            <name>Slava Karkunov</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Plugins for smart contract devs building on Near]]></title>
        <id>https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near</id>
        <link href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near"/>
        <updated>2024-01-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Let’s discover how ‘near-plugins’ library could be used by your project, and how it can save you some time during the development of your smart contracts]]></summary>
        <content type="html"><![CDATA[<p>Some common functionality is required for many smart contracts. Examples are temporarily pausing certain features, staging and deploying a new version of the contract, and restricting access to contract methods. While such functionality is out of scope for an SDK like <code>near-sdk-rs</code>, ideally it is not implemented anew for every smart contract.</p>
<p>The most obvious benefits of an open-source library are reusability and the value it adds to the ecosystem. The smart contract features mentioned above can be tricky to implement and cumbersome to test. Without a library, developers might gloss over functionality that does not add business value but still is critical for security. As <code>near-plugins</code> is open-source and used by many developers, there are more engineering hours and eyeballs dedicated to it compared to a solution specific to a single smart contract.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="case-study-a-counter-managing-permissions-with-acl">Case study: A counter managing permissions with ACL<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#case-study-a-counter-managing-permissions-with-acl" class="hash-link" aria-label="Direct link to Case study: A counter managing permissions with ACL" title="Direct link to Case study: A counter managing permissions with ACL">​</a></h2>
<p>Let’s look at a case study to see how <code>near-plugins</code> can be useful to smart contract developers. We are building a <code>Counter</code> that stores its current value and has methods to increment, decrement, and reset the value. It is intentionally kept simple to allow us to focus on how <code>near-plugins</code> adds functionality. This is what the contract looks like prior to using any plugins:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[init]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Anyone can retrieve the current value.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Increases the value of the counter by one.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Decreases the value of the counter by one.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">decrement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Resets the value of the counter to zero.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">reset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The final version of the code is available <a href="https://github.com/mooori/counter-acl-example" target="_blank" rel="noopener noreferrer"><em>in this repository on github</em></a>. The <em><code>Counter</code></em> example is inspired by <a href="https://github.com/near-examples/counter-rust" target="_blank" rel="noopener noreferrer"><em>near-examples/counter-rust</em></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="permissions">Permissions<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#permissions" class="hash-link" aria-label="Direct link to Permissions" title="Direct link to Permissions">​</a></h3>
<p>The contract methods defined above can be called by anyone since they are public and inside an implementation block marked with <code>#[near_bindgen]</code>. Using <code>near-sdk-rs</code> it is possible to restrict some methods such that they can be called only by the contract itself. Either by using <code>#[private]</code> or by not exposing the method publicly, as described in the <a href="https://docs.near.org/sdk/rust/contract-interface/private-methods" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<p>However, what if we wanted to implement more flexible permissions (e.g. allowing only some set of accounts to call a given function)? This is where the <a href="https://github.com/aurora-is-near/near-plugins#accesscontrollable" target="_blank" rel="noopener noreferrer"><code>AccessControllable</code></a> plugin comes in handy.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="managing-permissions-with-acl">Managing permissions with ACL<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#managing-permissions-with-acl" class="hash-link" aria-label="Direct link to Managing permissions with ACL" title="Direct link to Managing permissions with ACL">​</a></h3>
<p>ACL stands for <em>access control lists</em> and they are used in the following way within the <code>AccessControllable</code> plugin. The user defines the roles required for their use case as Rust enum variants. Then it is possible to restrict access to a method to accounts that have been granted roles. Restricting access is possible with one line of code, for example:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[access_control_any(roles(Role::Decrementer))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">decrement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let’s walk through it step by step to see how you can make your Near smart contract <code>AccessControllable</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="step-1-add-near-plugins-as-a-dependency">Step 1: Add <code>near-plugins</code> as a dependency<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#step-1-add-near-plugins-as-a-dependency" class="hash-link" aria-label="Direct link to step-1-add-near-plugins-as-a-dependency" title="Direct link to step-1-add-near-plugins-as-a-dependency">​</a></h3>
<p>For now, <code>near-plugins</code> has not yet been published on crates.io. Still, the crate is ready for usage and it can be added as git dependency:</p>
<div class="language-toml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-toml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain"># Add `near-plugins` under `dependencies` in your Cargo.toml.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">near-plugins = { git = "https://github.com/aurora-is-near/near-plugins.git", tag = "v0.2.0" }</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="step-2-define-roles">Step 2: Define roles<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#step-2-define-roles" class="hash-link" aria-label="Direct link to Step 2: Define roles" title="Direct link to Step 2: Define roles">​</a></h3>
<p>Every use case may require a different set of roles, so users may define their roles as variants of an enum. For the <code>Counter</code> example, we define the following roles:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[derive(AccessControlRole, Deserialize, Serialize, Copy, Clone)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[serde(crate = </span><span class="token attribute attr-name string" style="color:#e3116c">"near_sdk::serde"</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token type-definition class-name">Role</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Grantees of this role may decrease the counter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Decrementer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Grantees of this role may reset the counter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Resetter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Deriving the <code>AccessControlRole</code> trait prepares the <code>Role</code> enum for usage in the <code>AccessControllable</code> plugin.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="step-3-make-the-contract-accesscontrollable">Step 3: Make the contract <code>AccessControllable</code><a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#step-3-make-the-contract-accesscontrollable" class="hash-link" aria-label="Direct link to step-3-make-the-contract-accesscontrollable" title="Direct link to step-3-make-the-contract-accesscontrollable">​</a></h3>
<p>The contract is made <code>AccessControllable</code> by attaching the <code>access_control</code> attribute macro on the definition of the struct which represents the contract’s state. We pass our <code>Role</code> as argument to make the <code>AccessControllable</code> implementation aware of it:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[access_control(role_type(Role))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(PanicOnDefault, BorshDeserialize, BorshSerialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="step-4-restrict-contract-methods">Step 4: Restrict contract methods<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#step-4-restrict-contract-methods" class="hash-link" aria-label="Direct link to Step 4: Restrict contract methods" title="Direct link to Step 4: Restrict contract methods">​</a></h3>
<p>Access to a contract method is restricted by attaching <code>#[access_control_any]</code> and providing the roles to be whitelisted as arguments:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// We must be inside an implementation block with `#[near-bindgen]`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Resets the value of the counter to zero.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Only accounts that have been granted `Role::Resetter` may successfully call this method.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// If called by an account without this role, the method panics and state remains unchanged.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[access_control_any(roles(Role::Resetter))]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// enables ACL for this method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">reset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// By the way, it is also possible to restrict access to accounts that have been granted any of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// multiple roles. This is how the syntax looks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[access_control_any(roles(Role::Decrementer, Role::Resetter))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">no_op</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now the contract is set up for access control. The only step that is missing is granting roles to accounts, enabling them to call restricted methods.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="step-5-grant-permissions">Step 5: Grant permissions<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#step-5-grant-permissions" class="hash-link" aria-label="Direct link to Step 5: Grant permissions" title="Direct link to Step 5: Grant permissions">​</a></h3>
<p>In our contract’s constructor method <code>new()</code> we make the contract itself super admin:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token namespace" style="opacity:0.7">near_sdk</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token macro property" style="color:#36acaa">require!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    contract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">acl_init_super_admin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">current_account_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"Failed to initialize super admin"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>AccessControllable</code> super admin is an admin for every role defined in the <code>Role</code> enum. For this example, it is sufficient to know that a super admin may grant and revoke every role. Making the contract itself super admin facilitates the setup procedure as well as testing. More detailed information on admin roles can be found in the <a href="https://github.com/aurora-is-near/near-plugins/blob/master/near-plugins/src/access_controllable.rs" target="_blank" rel="noopener noreferrer">documentation</a> of the <code>AccessControllable</code> trait.</p>
<p>To grant the <code>Resetter</code> role to the account <code>alice.near</code>, the contract can call the following function on itself:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// See `AccessControllable::acl_grant_role` for details.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">acl_grant_role</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Resetter"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"alice.near"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>AccessControllable</code> trait provides many more methods to administer ACL permissions. After following the steps above, all of them are automatically implemented for a contract using the <code>AccessControllable</code> plugin.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="done">Done<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#done" class="hash-link" aria-label="Direct link to Done" title="Direct link to Done">​</a></h2>
<p>The steps above are sufficient to add complex and configurable ACL permissions to a contract using <code>near-plugins</code>. At this point, <code>alice.near</code> is the only account which has been granted the <code>Resetter</code> role. This means that only <code>alice.near</code> may successfully call the contract’s <code>reset()</code> method.</p>
<p>The repo contains an <a href="https://github.com/mooori/counter-acl-example/blob/main/tests/workflow.rs" target="_blank" rel="noopener noreferrer">integration test</a> which verifies that <code>AccessControllable</code> was set up correctly for our <code>Counter</code> contract. Take a look at it to learn more about interacting with an <code>AccessControllable</code> contract. To run the test on-chain in a local sandbox, it suffices to clone the repo and execute the following command. This is made possible by <a href="https://github.com/near/near-workspaces-rs" target="_blank" rel="noopener noreferrer">near-workspaces-rs</a>.</p>
<div class="language-undefined codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-undefined codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="teaser-how-it-works-internally">Teaser: How it works internally<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#teaser-how-it-works-internally" class="hash-link" aria-label="Direct link to Teaser: How it works internally" title="Direct link to Teaser: How it works internally">​</a></h2>
<p>Using <code>AccessControllable</code> extends the contract state to store the permissions that have been granted. Moreover, the <code>AccessControllable</code> trait is implemented for the contract to enable administering permissions. When <code>#[access_control_any(roles(...))]</code> is attached to a method, <code>near-plugin</code> injects code that checks if the caller was granted any of the required roles. If not, a panic is generated which aborts the function call.</p>
<p>To learn about all the details, you can dive into the <a href="https://github.com/aurora-is-near/near-plugins/blob/master/near-plugins-derive/src/access_controllable.rs" target="_blank" rel="noopener noreferrer">implementation</a> of the <code>AccessControllable</code> macro.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="a-note-on-testing">A note on testing<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#a-note-on-testing" class="hash-link" aria-label="Direct link to A note on testing" title="Direct link to A note on testing">​</a></h2>
<p>The functionality provided by <code>near-plugins</code> is critical for security and we strive to test it exhaustively. In tests, we compile demo contracts for all plugins and deploy them on-chain in a local sandbox. Then we verify that using a particular plugin adds exactly the expected functionality to the contract. These tests and demo contracts can be found <a href="https://github.com/aurora-is-near/near-plugins/tree/master/near-plugins-derive/tests" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="ready-for-production-though">Ready for production, though?<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#ready-for-production-though" class="hash-link" aria-label="Direct link to Ready for production, though?" title="Direct link to Ready for production, though?">​</a></h2>
<p>As mentioned earlier, <code>near-plugins</code> comes with the caveat of not yet being published to <em>crates.io</em>. Nevertheless, it is already used in some contracts on mainnet, e.g. contracts related to the <a href="https://rainbowbridge.app/transfer" target="_blank" rel="noopener noreferrer">Rainbow Bridge</a>. Moreover, both <a href="https://www.datocms-assets.com/50156/1680101850-hacken-near-plugins-final-report-updated-march2023.pdf" target="_blank" rel="noopener noreferrer">Hacken</a> and <a href="https://www.datocms-assets.com/50156/1680590522-auditone-near-plugins-final-report-updated-march2023.pdf" target="_blank" rel="noopener noreferrer">AuditOne</a> audited <code>near-plugins</code>, awarding it high scores.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="conclusion">Conclusion<a href="https://doc.aurora.dev/blog/plugins-for-smart-contract-devs-building-on-near#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Using <code>near-plugins</code>, developers can add complex functionality to their smart contracts with just a few lines of code. Developers can focus on creating value for their users by relying on <code>near-plugins</code> for some cumbersome administrative tasks that are nevertheless critical for security. We are testing all plugins extensively and the <code>near-plugins</code> crate has been audited twice. We hope to contribute to the Near ecosystem by providing secure smart contract plugins which developers can build upon.</p>
<p>This article provides a step-by-step guide to using the <code>AccessControllable</code> plugin. In principle, using other plugins is similar. Head over to the <a href="https://github.com/aurora-is-near/near-plugins" target="_blank" rel="noopener noreferrer">repository</a> and have a look at the documentation and tests to get started with other plugins.</p>]]></content>
        <author>
            <name>Moritz Zielke</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Contract Callbacks in XCC]]></title>
        <id>https://doc.aurora.dev/blog/contract-callbacks-in-xcc</id>
        <link href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc"/>
        <updated>2023-11-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In this post we focus on the need to refund tokens to a user in the event of an error. This will reveal a bit of a “gotcha” which developers new to the XCC may come across, and we’ll discuss how to overcome it]]></summary>
        <content type="html"><![CDATA[<p>In previous posts, we have written about the cross-contract calls (XCC) feature on Aurora. These include <a href="https://doc.aurora.dev/blog/cross-ecosystem-communication"><em>an overview</em></a>, <a href="https://doc.aurora.dev/blog/building-a-game-using-near-aurora-and-bos"><em>an application</em></a>, and a <a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing"><em>deep dive into writing tests</em></a>.</p>
<p>In this post, we continue with the XCC technical deep dive by discussing in more detail handling XCC results using callbacks. In particular, we focus on the concrete example of needing to refund tokens to a user in the event of an error. Along the way, this example will reveal a bit of a “gotcha” which developers new to the XCC feature may come across, and we’ll discuss how to overcome it.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="the-scenario">The Scenario<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-scenario" class="hash-link" aria-label="Direct link to The Scenario" title="Direct link to The Scenario">​</a></h2>
<p>This scenario comes from <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/tree/76cb2f4f5932b5b9dd887834e1f7528cdeb1837c/examples/ft-refund" target="_blank" rel="noopener noreferrer"><em>an example</em></a> present in the Aurora Contracts SDK. In the example, we suppose there is a contract for some Near app, A, which works with a <a href="https://nomicon.io/Standards/Tokens/FungibleToken/Core" target="_blank" rel="noopener noreferrer"><em>NEP-141</em></a> token, T, that has also been bridged to Aurora.</p>
<p>Our goal is to use XCC to allow Aurora users to interact with A using the ERC-20 version of T tokens they have on Aurora. We specifically want to handle the case where if there is an error in A, then the tokens are automatically returned to the user’s address on Aurora.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="the-contracts">The Contracts<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-contracts" class="hash-link" aria-label="Direct link to The Contracts" title="Direct link to The Contracts">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="the-nep-141-token-t">The NEP-141 Token T<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-nep-141-token-t" class="hash-link" aria-label="Direct link to The NEP-141 Token T" title="Direct link to The NEP-141 Token T">​</a></h3>
<p>This is a totally standard <a href="https://nomicon.io/Standards/Tokens/FungibleToken/Core" target="_blank" rel="noopener noreferrer"><em>NEP-141</em></a> token done with the <a href="https://docs.rs/near-contract-standards/latest/near_contract_standards/fungible_token/index.html" target="_blank" rel="noopener noreferrer"><em>reference implementation</em></a>. The only thing to say about this is that the mint function is public for the sake of the example.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(BorshSerialize, BorshDeserialize, PanicOnDefault)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Contract</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    symbol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decimals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">FungibleToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Contract</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[init]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> symbol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> decimals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            symbol</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            decimals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">FungibleToken</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">b"t"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_vec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[payable]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> account_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">U128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">internal_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">account_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> account_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">U128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">internal_withdraw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">account_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token namespace" style="opacity:0.7">near_contract_standards</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token macro property" style="color:#36acaa">impl_fungible_token_core!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Contract</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token namespace" style="opacity:0.7">near_contract_standards</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token macro property" style="color:#36acaa">impl_fungible_token_storage!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Contract</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="the-near-app-contract-a">The Near App Contract A<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-near-app-contract-a" class="hash-link" aria-label="Direct link to The Near App Contract A" title="Direct link to The Near App Contract A">​</a></h3>
<p>This is a very simple contract which only implements the ft_on_transfer function from the NEP-141 spec, thus allowing it to receive T tokens. The implementation of that function is also simple. It either accepts all the tokens or if the attached message is <code>refund</code> then it sends back all the tokens minus a small fee. This “refund” case is what we will focus on since it is in that situation that the returned tokens need to be given back to the user’s address on Aurora.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// A fee that is taken from amounts that are requested to be refunded.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">FEE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u128</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">77</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(BorshDeserialize, BorshSerialize, Default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">FtRefund</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">FungibleTokenReceiver</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token class-name">FtRefund</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">ft_on_transfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sender_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">U128</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">PromiseOrValue</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">U128</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">msg </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"refund"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> return_amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> amount</span><span class="token number" style="color:#36acaa">.0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">saturating_sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">FEE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">PromiseOrValue</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">U128</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">return_amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">PromiseOrValue</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="the-solidity-contract">The Solidity Contract<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-solidity-contract" class="hash-link" aria-label="Direct link to The Solidity Contract" title="Direct link to The Solidity Contract">​</a></h3>
<p>This contract uses the XCC feature to allow Aurora users to interact with the Near App Contract. The main entry point is ftTransferCall which takes as input the address of an ERC-20 token bridged from a NEP-141 token, the Near account name of that NEP-141 token, and an amount of tokens. The contract takes the user’s ERC-20 token on Aurora, bridges them back as NEP-141 tokens on its XCC account on Near, and then uses that account to send the NEP-141 tokens to the Near App Contract via <code>ft_transfer_call</code>.</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ftTransferCall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IEvmErc20 token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> tokenId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">uint128</span><span class="token plain"> amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transferFrom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">withdrawToNear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodePacked</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AuroraSdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">nearRepresentative</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodePacked</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"{"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'"receiver_id": "'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nearAccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'",'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'"amount": "'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Strings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'",'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'"msg": "refund"'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callFtTransfer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"ft_transfer_call"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FT_TRANSFER_CALL_NEAR_GAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callback </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">auroraCall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeWithSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ftTransferCallCallback</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">selector</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tokenId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CALLBACK_NEAR_GAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    callFtTransfer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There is also a callback for this function which handles the result of that XCC call. The callback is defined in the function ftTransferCallCallback. The logic of this function is to check if there are any tokens that need to be returned to the user on Aurora, and if there are, bridge them back to the user’s address using another ft_transfer_call from the NEP-141 token to Aurora.</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ftTransferCallCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">address</span><span class="token plain"> sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> tokenIdOnNear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">uint128</span><span class="token plain"> amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onlyRole</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CALLBACK_ROLE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromiseResult </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> promiseResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AuroraSdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">promiseResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">uint128</span><span class="token plain"> refundAmount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promiseResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> PromiseResultStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Successful</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// if Promise failed we need to do whole refund</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        refundAmount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// else `ft_resolve_transfer` will return used amount of FT,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// which we need to extract from original amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">uint128</span><span class="token plain"> usedAmount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_stringToUint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promiseResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        refundAmount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> amount </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> usedAmount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">refundAmount </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodePacked</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"{"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'"receiver_id": "'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AuroraSdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">currentAccountId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'",'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'"amount": "'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Strings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">refundAmount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'",'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'"msg": "'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">_toHexString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">uint160</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'"}'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callFtTransfer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tokenIdOnNear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"ft_transfer_call"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            REFUND_NEAR_GAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        callFtTransfer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="the-trap">The Trap<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#the-trap" class="hash-link" aria-label="Direct link to The Trap" title="Direct link to The Trap">​</a></h2>
<p>So far so good, everything looks straightforward. But this is where we hit a small “gotcha”. The NEP-141 token standard requires attaching 1 yoctoNEAR to ft_transfer_call. This means not only is ftTransferCall spending 1 yoctoNEAR, but so is ftTransferCallCallback in the case that a refund is needed. Someone needs to pay for this cost, and the Aurora Contact SDK <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/blob/76cb2f4f5932b5b9dd887834e1f7528cdeb1837c/aurora-solidity-sdk/src/AuroraSdk.sol#L142" target="_blank" rel="noopener noreferrer"><em>passes that cost on to the caller of the function</em></a>.</p>
<p>In the case of ftTransferCall, that caller is the user, no problem. But who is the caller in the case of ftTransferCallCallback? One hint comes from the permissions on ftTransferCallCallback. It can only be called by the <code>CALLBACK_ROLE</code>, which is only assigned to the address computed from <code>AuroraSdk.nearRepresentitiveImplicitAddress(address(this))</code>. Therefore this address must approve the Solidity contract to spend its wNEAR in order for it to cover the 1 yoctoNEAR cost in the callback.</p>
<p>This is the reason for the approveWNEAR function, which is also present in the Solidity contract. It does this approval so that wNEAR can be spent in the callback.</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">approveWNEAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">uint256</span><span class="token plain"> amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> approveCall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">auroraCall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">wNEAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        abi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encodeWithSelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0x095ea7b3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// approve method selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        APPROVE_NEAR_GAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    approveCall</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The need for this function is rather quirky. Logically <code>nearRepresentitiveImplicitAddress</code> should be the identity function because it is returning the address on Aurora that corresponds to the XCC account of an Aurora address; meaning that the only way transactions can come from the <code>nearRepresentitiveImplicitAddress(address)</code> is if they were originally sent from the address itself.</p>
<p>Unfortunately, it is not the identity function because the notion of an implicit Aurora address for any named account on Near was defined long before the XCC feature was invented. The implementation of this is the most natural one: derive the address from the named account the same way addresses are derived from a public key; take the hash and use the last 20 bytes. Composing this implementation with the way XCC accounts are named results in returning a different address than we started with.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// The XCC account for an Aurora address is a subaccount of Aurora.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">near_representative</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">format!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{}.aurora"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">hex</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// The implicit address on Aurora of a Near account is derived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// in the "obvious" way.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">aurora_implicit_address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">hash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">account</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Composing these functions logically should be the identity function,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// but these implementations do not do that unfortunately.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">near_representative_implicit_address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">aurora_implicit_address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">near_representative</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">debug_assert!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="conclusion">Conclusion<a href="https://doc.aurora.dev/blog/contract-callbacks-in-xcc#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In conclusion, it is important to remember when working with XCC that there are two addresses which logically correspond to the contract you are working with. One is, of course, the address where the contract is deployed, <code>address(this)</code>. The other is the address which becomes the caller in XCC callbacks, <code>AuroraSdk.nearRepresentitiveImplicitAddress(address(this))</code>. Sometimes it will be important to have a contract “approve itself” when it comes to spending tokens because these two addresses are different.</p>
<p>To check your understanding of this post, take a look at the full code for this token refund <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/tree/76cb2f4f5932b5b9dd887834e1f7528cdeb1837c/examples/ft-refund" target="_blank" rel="noopener noreferrer"><em>example on GitHub</em></a> and play with it yourself! What happens when you remove <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/blob/76cb2f4f5932b5b9dd887834e1f7528cdeb1837c/examples/ft-refund/integration-tests/src/lib.rs#L203C1-L223C47" target="_blank" rel="noopener noreferrer"><em>the call to approveWNEAR from the integration test</em></a>? What error do you see and why?</p>]]></content>
        <author>
            <name>Michael Birch</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Practical ERC20 Burning]]></title>
        <id>https://doc.aurora.dev/blog/practical-erc20-burning</id>
        <link href="https://doc.aurora.dev/blog/practical-erc20-burning"/>
        <updated>2023-09-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Token burning is the act of permanently removing a certain number of tokens from circulation. This article delves into its intricacies and offers guidance based on my real-world experiences at Aurora]]></summary>
        <content type="html"><![CDATA[<p>Token burning is the act of permanently removing a certain number of tokens from circulation. This article delves into its intricacies and offers guidance based on my real-world experiences at Aurora</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="why-is-there-a-problem">Why is there a problem?<a href="https://doc.aurora.dev/blog/practical-erc20-burning#why-is-there-a-problem" class="hash-link" aria-label="Direct link to Why is there a problem?" title="Direct link to Why is there a problem?">​</a></h2>
<p>The ERC20 standard does not inherently specify a token burning mechanism.</p>
<p>The most common implementation of ERC20 <a href="https://docs.openzeppelin.com/contracts/4.x/api/token/erc20?ref=lapitsky.com#ERC20Burnable" target="_blank" rel="noopener noreferrer">provides</a> <code>ERC20Burnable</code> to solve that, but not all deployed OpenZepellin contracts include <code>ERC20Burnable</code>. Many ERC20 contracts are locked and not upgradeable.</p>
<p>Due to these constraints, projects seek alternative ways to approach token burns.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="do-not-use-contract-burns">Do not use contract burns<a href="https://doc.aurora.dev/blog/practical-erc20-burning#do-not-use-contract-burns" class="hash-link" aria-label="Direct link to Do not use contract burns" title="Direct link to Do not use contract burns">​</a></h2>
<p>One often recommended way to burn tokens involves creating a contract that immediately self-destructs and sends tokens to its own address. However, this method comes with its set of challenges:</p>
<ul>
<li>The overhead of creating, deploying, and testing such contracts, especially if the burn needs to happen periodically</li>
<li>Even if the contract uses <code>SELFDESTRUCT</code> it does not preclude the possibility of redeploying another contract at the same address. This has been successfully exploited in the infamous <a href="https://forum.tornado.ws/t/full-governance-attack-description/62?ref=lapitsky.com" target="_blank" rel="noopener noreferrer">Tornado Cash attack</a> by using a metamorphic contract factory.</li>
<li>There is a negative sentiment against <code>SELFDESTRUCT</code> opcode and (although stagnant) <a href="https://eips.ethereum.org/EIPS/eip-4758?ref=lapitsky.com" target="_blank" rel="noopener noreferrer">EIP-4758</a> that highlights some security concerns.</li>
<li>Token burns via this method aren't recognized on most analytics platforms.</li>
</ul>
<p>Given the listed concerns, I advise against this approach and encourage the use of burn addresses.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="use-well-known-burn-addresses">Use well-known burn addresses<a href="https://doc.aurora.dev/blog/practical-erc20-burning#use-well-known-burn-addresses" class="hash-link" aria-label="Direct link to Use well-known burn addresses" title="Direct link to Use well-known burn addresses">​</a></h2>
<p>A burn address is a recognized externally owned account (<a href="https://ethereum.org/en/whitepaper/?ref=lapitsky.com#ethereum-accounts" target="_blank" rel="noopener noreferrer">EOA</a>) where tokens can be sent to symbolize their destruction. While the token count remains unchanged, these tokens are effectively removed from circulation since no private key can control the burn address.</p>
<p>One of the common questions is "What if somebody knows or brute forces the private keys for such EOA addresses?"</p>
<p>Ethereum security model rests on the practical impossibility of brute forcing EOA accounts, so it does not make sense to take the risk of such an attack into account when planning the burns. To mitigate the risk of malicious burn addresses, use only the well-known ones.</p>
<p>You can find the list of burn addresses on <a href="https://etherscan.io/accounts/label/burn?ref=lapitsky.com" target="_blank" rel="noopener noreferrer">Etherscan</a> but I recommend limiting it to the top two that stand out by the TVL and number of transactions: <code>0x0000000000000000000000000000000000000000</code> (<em>null</em>) and <code>0x000000000000000000000000000000000000dEaD</code> (<em>dead</em>).</p>
<p>Interestingly, OpenZeppelin's ERC20 implementation restricts transfers to <em>null</em> which could leave you with the second-best choice: <em>dead.</em></p>
<p>The benefit of using well-known burn addresses over "contract burns" is that burn addresses are accounted for and integrated into numerous analytics tools, ensuring accurate token burn data representation.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="bonus-tips">Bonus tips<a href="https://doc.aurora.dev/blog/practical-erc20-burning#bonus-tips" class="hash-link" aria-label="Direct link to Bonus tips" title="Direct link to Bonus tips">​</a></h2>
<ul>
<li>Ensure that your ERC20 contract is locked and immutable before initiating burns.</li>
<li>For ERC20 tokens on multiple networks, execute burns on your primary network only, for unified tracking and analytics.</li>
<li>For the first burn, refrain from using decentralized or ZK-bridges. If your contract unexpectedly rejects the transaction (like disallowing transfers to <em>null</em>) – it might muddle your analytics even though the tokens are technically burned.</li>
</ul>
<p>Big thanks to <a href="https://www.linkedin.com/in/lance-henderson/?ref=lapitsky.com" target="_blank" rel="noopener noreferrer">Lance Henderson</a> for technical insights and for reviewing this post!</p>]]></content>
        <author>
            <name>Alexey Lapitsky</name>
        </author>
        <category label="Tips & Tricks" term="Tips & Tricks"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Integration tests for XCC communication]]></title>
        <id>https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing</id>
        <link href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing"/>
        <updated>2023-09-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[XCC is a powerful tool to merge blockchain ecosystems together. In this post we will talk about how to write integration tests for the XCC contracts communicating between Aurora and Near using Rust]]></summary>
        <content type="html"><![CDATA[<p>In this article, we will learn how to write local tests for the Aurora contracts, which use <a href="https://doc.aurora.dev/blog/cross-ecosystem-communication">XCC calls</a> to Near ecosystem. I will use a simple example to demonstrate it, step by step, we will write:</p>
<ol>
<li>A simple counter contract for Near blockchain.</li>
<li>Contract on Aurora, which calls the contract on Near by using the XCC.</li>
<li>One integration test in the <code>sandbox</code>.</li>
<li>Setup the <code>git action</code> for running this test automatically.</li>
</ol>
<p>The example described in this article: <a href="https://github.com/olga24912/AuroraToNearXCCExample" target="_blank" rel="noopener noreferrer">https://github.com/olga24912/AuroraToNearXCCExample</a></p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="counter-contract-on-near">Counter contract on Near<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#counter-contract-on-near" class="hash-link" aria-label="Direct link to Counter contract on Near" title="Direct link to Counter contract on Near">​</a></h2>
<p>I assume that you have already cloned a git repo locally or just created your own repo, in the case you want to add everything file by file to your project using this article.</p>
<p>We will start with creating a simple Counter contract on Near, which just has two functions: <code>increment</code> – for changing the value, and <code>get_num</code> – to return the current value.</p>
<p>We should have the following directories and files in <code>near</code> folder:</p>
<div class="language-toml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-toml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">AuroraToNearXCCExample: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- near</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- build.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- Cargo.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |   |-- lib.rs</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let's take a look at each of the files.</p>
<p><code>lib.rs</code>:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">near_sdk</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">borsh</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BorshDeserialize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BorshSerialize</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">near_sdk</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">near_bindgen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">PanicOnDefault</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(PanicOnDefault, BorshDeserialize, BorshSerialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[near_bindgen]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[init]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">get_num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>Cargo.toml</code>:</p>
<div class="language-toml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-toml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">[package]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = "counter"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">edition = "2021"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[lib]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crate-type = ["cdylib", "rlib"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">near-sdk = "4.1.1"</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For compiling the contract into a WASM file, we will use the script <code>build.sh</code>:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rustup target add wasm32-unknown-unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUSTFLAGS='-C link-arg=-s' cargo build --target wasm32-unknown-unknown --release</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To compile the contract run:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">./build.sh</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The target file: <code>near/contracts/target/wasm32-unknown-unknown/release/counter.wasm</code></p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="counter-contract-on-aurora">Counter contract on Aurora<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#counter-contract-on-aurora" class="hash-link" aria-label="Direct link to Counter contract on Aurora" title="Direct link to Counter contract on Aurora">​</a></h2>
<p>We already created a counter contract for Near, and now let's create the counter contract on Aurora, which will have one method <code>incrementXCC</code> inside, which we will call the <code>increment</code> method in the Near Counter contract.</p>
<p>First, create the following folder structure and the <code>Counter.sol</code> file</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">AuroraToNearXCCExample:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |   |-- Counter.sol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- near</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>Counter.sol</code> file:</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pragma</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">solidity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token version number" style="color:#36acaa">0.8.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">IERC20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@openzeppelin/contracts/token/ERC20/IERC20.sol"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">AuroraSdk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NEAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PromiseCreateArgs</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@auroraisnear/aurora-sdk/aurora-sdk/AuroraSdk.sol"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">contract</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token class-name">AuroraSdk</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> NEAR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token class-name">AuroraSdk</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> PromiseCreateArgs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">uint64</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">constant</span><span class="token plain"> COUNTER_NEAR_GAS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">_000_000_000_000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NEAR </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">string</span><span class="token plain"> counterAccountId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">address</span><span class="token plain"> wnearAddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> counterNearAccountId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        near </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AuroraSdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initNear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wnearAddress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counterAccountId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counterNearAccountId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">incrementXCC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'{"value": 1}'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PromiseCreateArgs </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> callCounter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            counterAccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"increment"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            COUNTER_NEAR_GAS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        callCounter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>More information about how the aurora contracts with XCC work can be found <a href="https://doc.aurora.dev/blog/cross-ecosystem-communication">here,</a> or <a href="https://doc.aurora.dev/blog/building-a-game-using-near-aurora-and-bos">in this game example,</a> or in these <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/blob/main/docs/NearFromAurora.md" target="_blank" rel="noopener noreferrer">official docs</a> in aurora-contracts-sdk repo.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="install-dependencies-for-counter-contract-on-aurora">Install dependencies for counter contract on Aurora<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#install-dependencies-for-counter-contract-on-aurora" class="hash-link" aria-label="Direct link to Install dependencies for counter contract on Aurora" title="Direct link to Install dependencies for counter contract on Aurora">​</a></h3>
<p>For deploying the counter contract on Aurora in integration tests, we should install <code>foundry</code> and the dependencies. First, go to <code>aurora</code> folder and install <code>aurora-sdk</code> by running:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">yarn init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yarn add @auroraisnear/aurora-sdk</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For compiling aurora contracts in the test, we will use foundry. How to install foundry you can read <a href="https://book.getfoundry.sh/getting-started/installation" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>We should create <code>foundry.toml</code> in <code>aurora/contracts</code> folder.</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">AuroraToNearXCCExample:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- foundry.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- integration-tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- near</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>foundry.toml</code>:</p>
<div class="language-toml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-toml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">[profile.default]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src = 'src'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">out = 'out'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libs = ['lib', '../node_modules']</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allow_paths = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">solc = "0.8.17"</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After that you need to run the next command from <code>aurora/contracts</code> folder:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf lib/aurora-contracts-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">forge install aurora-is-near/aurora-contracts-sdk --no-commit</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After command execution in the <code>aurora/contracts</code> directory, the <code>lib</code> folder with <code>aurora-contracts-sdk</code> and all necessary files inside will be created.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="integration-test">Integration test<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#integration-test" class="hash-link" aria-label="Direct link to Integration test" title="Direct link to Integration test">​</a></h2>
<p>It is time to create an integration test! Go back to the <code>aurora</code> folder with <code>cd ..</code> and run (or just use already existing folder from repo):</p>
<div class="language-solidity codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-solidity codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">cargo </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">lib integration</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">tests</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>integration-tests</code> folder will be created. We should also create the following <code>rust-toolchain</code> file in this folder:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">toolchain</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.66.1"</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We need this because this channel is used in dependencies, and we should use the same channel to make contracts work properly. For people outside the Rust community, you can think about this as setting the Rust version, more info is <a href="https://rust-lang.github.io/rustup/concepts/toolchains.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>We should obtain this folder structure:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">AuroraToNearXCCExample:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- contracts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-- integration-tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- Cargo.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |   |-- lib.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   |-- rust-toolchain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- near</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Edit now <code>lib.rs</code>:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[cfg(test)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">tests</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">tokio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">counter_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>and Cargo.toml</code>:</p>
<div class="language-toml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-toml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">[package]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = "integration-tests"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">edition = "2021"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aurora-sdk-integration-tests = { git = "https://github.com/aurora-is-near/aurora-contracts-sdk.git" }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">near-sdk = "4.1.1"</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The command for running the test should run this succesfully:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should see output like this afterwards:</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">Compiling integration-tests v0.1.0 (/Users/aurora/Projects/AuroraToNearXCCExample/aurora/integration-tests)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Finished test [unoptimized + debuginfo] target(s) in 2.86s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Running unittests src/lib.rs (target/debug/deps/integration_tests-307b69604bee401f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">running 1 test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test tests::counter_test ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00ss</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="deploy-near-contract-in-integration-tests">Deploy Near contract in integration tests<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#deploy-near-contract-in-integration-tests" class="hash-link" aria-label="Direct link to Deploy Near contract in integration tests" title="Direct link to Deploy Near contract in integration tests">​</a></h3>
<p>Let's start writing our test with compiling and deploying the Counter contract on Near inside the sandbox. To do this we will: create the sandbox workspace with <code>workspaces::sandbox()</code>, compile near contract by using <code>build.sh</code> script (as we did above in section <code>Create Counter contract on Near</code>), deploy the contract with <code>worker.dev_deploy</code> and call the constructor with <code>near_counter.call("new").</code></p>
<p>All of that is inside the <code>deploy_near_counter</code> function, which we will use now directly in our <code>counter_test</code>. The full code is below:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use aurora_sdk_integration_tests::{tokio, workspaces, {utils::process}};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use aurora_sdk_integration_tests::workspaces::Contract;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use std::path::Path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[tokio::test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    async fn counter_test() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let worker = workspaces::sandbox().await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let near_counter = deploy_near_counter(&amp;worker).await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    async fn deploy_near_counter(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker: &amp;workspaces::Worker[workspaces::network::Sandbox](workspaces::network::Sandbox),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Contract {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let contract_path = Path::new("../../near/contracts");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let output = tokio::process::Command::new("bash")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .current_dir(contract_path)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .args(["build.sh"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .output()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .await</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        process::require_success(&amp;output).unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let artifact_path =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            contract_path.join("target/wasm32-unknown-unknown/release/counter.wasm");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let wasm_bytes = tokio::fs::read(artifact_path).await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let near_counter = worker.dev_deploy(&amp;wasm_bytes).await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        near_counter.call("new").transact().await.unwrap().into_result().unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        near_counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can run <code>cargo test</code> to check if your code is working at this stage.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="deploy-aurora-engine-and-wnear">Deploy Aurora Engine and wNEAR<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#deploy-aurora-engine-and-wnear" class="hash-link" aria-label="Direct link to Deploy Aurora Engine and wNEAR" title="Direct link to Deploy Aurora Engine and wNEAR">​</a></h3>
<p>Now, let's deploy the Aurora Engine contract itself to the sandbox. Also, we will need to deploy wNEAR in Aurora. It is the ERC-20 on Aurora which corresponds to the Near token on Near. We will use this token later for the payment.</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use aurora_sdk_integration_tests::{tokio, workspaces, {utils::process}, aurora_engine, wnear, workspaces::Contract};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use aurora_sdk_integration_tests::workspaces::Contract;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use std::path::Path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[tokio::test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    async fn counter_test() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let worker = workspaces::sandbox().await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let near_counter = deploy_near_counter(&amp;worker).await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let engine = aurora_engine::deploy_latest(&amp;worker).await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let wnear = wnear::Wnear::deploy(&amp;worker, &amp;engine).await.unwrap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="deploy-counter-contract-on-aurora-in-integration-tests">Deploy counter contract on Aurora in integration tests<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#deploy-counter-contract-on-aurora-in-integration-tests" class="hash-link" aria-label="Direct link to Deploy counter contract on Aurora in integration tests" title="Direct link to Deploy counter contract on Aurora in integration tests">​</a></h3>
<p>Moving to deploying counter contract to Aurora. We are creating a new user account and function to deploy the counter. This function takes: (1) aurora engine, (2) user account, (3) wNear address on aurora, (4) Counter Account ID on Near.</p>
<p>Let's add new dependencies first:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[cfg(test)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">tests</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">tokio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> workspaces</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token namespace" style="opacity:0.7">utils</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> aurora_engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> wnear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ethabi</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">workspaces</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Contract</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">aurora_engine_types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">aurora_engine</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">AuroraEngine</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">utils</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">forge</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">utils</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">ethabi</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">DeployedContract</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now let's define <code>deploy_aurora_counter</code> function and add it to out test:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">counter_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> user_account </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> worker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dev_create_account</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> aurora_counter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">deploy_aurora_counter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> wnear</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aurora_token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">near_counter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">deploy_aurora_counter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">AuroraEngine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   user_account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token namespace" style="opacity:0.7">workspaces</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   wnear_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   near_counter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">DeployedContract</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To deploy aurora contract we should first compile and deploy <code>aurora_sdk_lib</code>, and corresponding dependencies:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">deploy_aurora_counter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">AuroraEngine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   user_account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token namespace" style="opacity:0.7">workspaces</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   wnear_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   near_counter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Contract</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">DeployedContract</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> contract_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"../contracts"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> aurora_sdk_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Path</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"../contracts/lib/aurora-contracts-sdk/aurora-solidity-sdk"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> codec_lib </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">forge</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">deploy_codec_lib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">aurora_sdk_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> engine</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> utils_lib </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">forge</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">deploy_utils_lib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">aurora_sdk_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> engine</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> aurora_sdk_lib </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">forge</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">deploy_aurora_sdk_lib</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">aurora_sdk_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> codec_lib</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> utils_lib</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After that, we can compile and deploy the counter contract itself:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> constructor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">forge</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">forge_build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      contract_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token macro property" style="color:#36acaa">format!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token string" style="color:#e3116c">"@auroraisnear/aurora-sdk/aurora-sdk/AuroraSdk.sol:AuroraSdk:0x{}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         aurora_sdk_lib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"out"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Counter.sol"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Counter.json"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> deploy_bytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create_deploy_bytes_with_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">ethabi</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Token</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wnear_address</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">raw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">ethabi</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Token</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">near_counter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">deploy_evm_contract_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> deploy_bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">deployed_at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="mint-wnear-for-user">Mint wNEAR for user<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#mint-wnear-for-user" class="hash-link" aria-label="Direct link to Mint wNEAR for user" title="Direct link to Mint wNEAR for user">​</a></h3>
<p>When we use XCC for the first time in our setup, the implicit contract on the Near will be created. You can read more about it <a href="https://github.com/aurora-is-near/aurora-contracts-sdk/blob/main/docs/NearFromAurora.md" target="_blank" rel="noopener noreferrer">here</a>. We also could call this implicit contract as sub-account. The overall scheme could be presented as:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1694083461-screenshot-2023-09-07-at-11-42-21.png" alt="" class="img__pfF"></p>
<p>Creation of a sub-account will cost you 2 NEAR tokens. That is why we need to mint 2 wNEAR for our user on Aurora after approving the spending of the wNear by counter contract.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">///....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">aurora_engine_sdk</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">near_account_to_evm_address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">aurora_engine_types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token constant" style="color:#36acaa">U256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">counter_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> user_address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">near_account_to_evm_address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">as_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NEAR_DEPOSIT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u128</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">near_sdk</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token constant" style="color:#36acaa">ONE_NEAR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mint_wnear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">wnear</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user_address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NEAR_DEPOSIT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> evm_call_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wnear</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aurora_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create_approve_call_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aurora_counter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">U256</span><span class="token punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">MAX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call_evm_contract_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wnear</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aurora_token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        evm_call_args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">aurora_engine</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">unwrap_success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="call-incrementxcc-method-in-counter-contract-on-aurora">Call incrementXCC method in counter contract on Aurora<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#call-incrementxcc-method-in-counter-contract-on-aurora" class="hash-link" aria-label="Direct link to Call incrementXCC method in counter contract on Aurora" title="Direct link to Call incrementXCC method in counter contract on Aurora">​</a></h3>
<p>In this section, we will write a function that calls the <code>incrementXCC</code> method in the Counter contract on Aurora. <code>incrementXCC</code> method is calling inside the <code>increment</code> method from the Near contract and counter is incremented on Near.</p>
<p>Let's write <code>increment</code> function in our test now, which will call the <code>incrementXCC</code> from the Aurora's contract. We'll provide as input: (1) aurora engine contract deployed in the sandbox, (2) the near account of the user which will sign the transaction, (3) the counter contract deployed on aurora.</p>
<p>Notice that we're going to call the method in the aurora contract, but in this function, the user account ID on Near is provided. We can do this because it is possible to call the aurora's counter contract method by using <code>call</code> method from the Aurora Engine contract.</p>
<p>In that case, the near user will sign a transaction, but inside the Aurora Engine, there is <a href="https://github.com/aurora-is-near/aurora-engine/blob/71980db92a9d4b95d4e1f53954b98e0e8f002a4b/engine-sdk/src/types.rs#L28" target="_blank" rel="noopener noreferrer">an implicit mapping</a> between the near account ID and aurora addresses. And it is precisely how we will communicate with the contract in our test.</p>
<p>Now, let's first encode the arguments for the <code>call</code> method in the <code>AuroraEngine</code> contract on Near and after that – submit a transaction and check its result:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">aurora_sdk_integration_tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">aurora_engine_types</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">parameters</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token namespace" style="opacity:0.7">engine</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">CallArgs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">FunctionCallArgsV1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[tokio::test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">counter_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">engine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> aurora_counter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">increment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    engine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">AuroraEngine</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_account</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token namespace" style="opacity:0.7">workspaces</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aurora_counter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">DeployedContract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> contract_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aurora_counter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create_call_method_bytes_without_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"incrementXCC"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">call_evm_contract_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          aurora_counter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">ContractInput</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contract_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token namespace" style="opacity:0.7">aurora_engine</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">unwrap_success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="check-counter-value-on-near">Check counter value on Near<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#check-counter-value-on-near" class="hash-link" aria-label="Direct link to Check counter value on Near" title="Direct link to Check counter value on Near">​</a></h3>
<p>Let’s check that the counter has been incremented at the Counter contract on Near. For that, call the <code>get_num</code> view method at the counter and check that the result equals 1.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[tokio::test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">counter_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> counter_val</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> near_counter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">view</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"get_num"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">counter_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="run-final-test">Run final test<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#run-final-test" class="hash-link" aria-label="Direct link to Run final test" title="Direct link to Run final test">​</a></h3>
<p>Now, when everything is ready, let's go to <code>aurora/integration-tests/</code> directory and run to check that we have the expected results:</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="git-action">Git Action<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#git-action" class="hash-link" aria-label="Direct link to Git Action" title="Direct link to Git Action">​</a></h2>
<p>Now, let's set up the git action so that the test runs automatically every time we push changes. To set it up, we must create <code>.github/workflow/test.yml</code> and <code>Makefile</code>.</p>
<div class="language-bash codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-bash codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">AuroraToNearXCCExample:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- aurora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- near</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- .github/workflow/test.yml</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>.github/workflows/test.yml</code> contains the git action description. In our case, we are going to run it on <code>push</code> events. First, we install <code>foundry</code> for compiling our Solidity contracts, second, we checkout the repository with all submodules, and in the end, run the script from Makefile.</p>
<div class="language-yaml codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-yaml codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aurora</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">near</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">xcc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example test automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">push</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test-counter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install Foundry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> foundry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rs/foundry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">toolchain@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Clone the repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">submodules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> recursive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          make test-counter</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, let’s take a closer look at the <code>Makefile</code> . First, we go to the <code>aurora</code> directory and install dependencies, second, we compile near contracts, and in the end, run our integration test.</p>
<div class="language-makefile codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-makefile codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">test-counter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cd aurora &amp;&amp; \\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        yarn add @auroraisnear/aurora-sdk &amp;&amp; \\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cd ../near/contracts &amp;&amp; \\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ./build.sh &amp;&amp; \\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cd ../../aurora/integration-tests &amp;&amp; \\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cargo test --all --jobs 4 -- --test-threads 4</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That is it, we have set up the git action! Now, our integration test will run automatically after each push to our GitHub repo.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="conclusion">Conclusion<a href="https://doc.aurora.dev/blog/communication-from-aurora-to-near-local-testing#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In this article, we have created a simple contract on Aurora, which calls the function from Near contract. We have learned how it is possible to test such contracts inside the sandbox locally. And in the end, we have set up the git action to make the test run automatically.</p>
<p>I hope this article will make it easier for you to develop contracts on Aurora with XCC to Near.</p>
<p>Happy development! In a case you will have any questions about this article, feel free to contract our DevSupport team on <a href="https://discord.com/invite/dEFJBz8HQV" target="_blank" rel="noopener noreferrer">our Discord server</a>.</p>
<p>The example from this article you can find in this repo: <a href="https://github.com/olga24912/AuroraToNearXCCExample" target="_blank" rel="noopener noreferrer">https://github.com/olga24912/AuroraToNearXCCExample</a></p>]]></content>
        <author>
            <name>Olga Kunyavskaya</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Turning Smart Contracts into Indexers]]></title>
        <id>https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers</id>
        <link href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers"/>
        <updated>2023-08-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Learn how you can use functional programming patterns in Rust to share a codebase between both a smart contract and an indexer, and how cross-compilation can benefit your project]]></summary>
        <content type="html"><![CDATA[<p>Recently, Michael Birch gave a <a href="https://www.conf42.com/Rustlang_2023_Michael_Birch_smart_contracts_indexers_crosscompilation" target="_blank" rel="noopener noreferrer"><em>talk at a virtual Rust conference</em></a> about some work we have done here at Aurora to enable our technology. In case you missed it, this blog post is a written version of the talk.</p>
<p>That talk was aimed at a more general audience, giving background about Aurora, Near, and blockchain technology in general. However, this post assumes you are already familiar with most of the Aurora/Near/blockchain background (you are here on our website, after all) and instead focuses more on the Rust side of things.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="motivation">Motivation<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2>
<p>The goal of this post is to describe how you can use functional programming patterns in Rust to share a codebase between both a smart contract and an indexer. But the first question to answer is why this is desirable in the first place.</p>
<p>Indexers provide a specialized view of the blockchain state to enable low-latency responses to particular kinds of queries. For example, block explorers will use an indexer to show the balances of all the tokens held by a user. An indexer is required to accomplish this because the on-chain information about balances is indexed in the opposite way to how the block explorer displays the information. By which I mean that on-chain each token has information about all the addresses with a non-zero balance, but the block explorer shows all the non-zero balances for a single address.</p>
<p>Generally, indexers are specialized to follow the state of a particular contract (or class of contracts). Therefore, the code for the indexer is closely related to the code for the smart contract it follows. Thus, it would be lower developer maintenance to have a common codebase for the smart contract and its associated indexer.</p>
<p>Additionally, sharing a codebase makes it possible to create much more powerful indexers than simply something that can respond to queries. For example, an indexer with access to the smart contract logic can simulate whole transactions off-chain to provide free and low-latency feedback to users on potential errors.</p>
<p>In the case of Aurora, the indexer we use for the Aurora Engine smart contract serves data that is used by <a href="https://doc.aurora.dev/blog/spinning-up-your-own-aurora-node">our RPC implementation.</a> The Ethereum RPC spec includes a few methods (e.g., <code>eth_estimateGas</code>) which require simulating transactions before submitting them to the chain. Therefore, we have a clear use for the extra indexer features that are enabled by having a shared codebase between the Aurora Engine and its indexer.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="rust-features">Rust Features<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#rust-features" class="hash-link" aria-label="Direct link to Rust Features" title="Direct link to Rust Features">​</a></h2>
<p>To reach the goal of having a shared codebase between the Aurora Engine and an indexer for the Engine, we leverage some features of Rust.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="cross-compilation">Cross-Compilation<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#cross-compilation" class="hash-link" aria-label="Direct link to Cross-Compilation" title="Direct link to Cross-Compilation">​</a></h3>
<p>The Aurora Engine is written in Rust because it is a smart contract on Near which uses Web Assembly as its runtime. Rust has good support for Web Assembly (Wasm) as a compilation target, so it is a good language choice for writing smart contracts for Near. But, of course, it also is able to compile the same code to executable binaries for typical platforms (e.g., Linux). Compiling the same code to multiple output targets is referred to as “cross-compiling”.</p>
<p>The first step to having our smart contract code also be used as an indexer is to cross-compile the same code as both Wasm and a native executable. In Rust, it is easy to install other compilation targets (the default target will be whatever platform you installed Rust on) and to specify them as the compilation target. The following commands show installing the Wasm target and compiling a project to Wasm.</p>
<div class="language-shell codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-shell codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token plain">$ rustup target add wasm32-unknown-unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cargo build --release –-target wasm32-unknown-unknown</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="conditional-compilation">Conditional Compilation<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#conditional-compilation" class="hash-link" aria-label="Direct link to Conditional Compilation" title="Direct link to Conditional Compilation">​</a></h3>
<p>When you start compiling code to multiple platforms, likely there will be situations where you want the implementation to differ depending on the compilation target. For example, native code can read from a local file system, whereas Wasm modules need to delegate to their host (the machine running the Wasm VM) to access state.</p>
<p>In Rust, you can use conditional compilation to have different implementations depending on the target. In the example below, the function `foo` has different implementations depending on if the compilation target is Wasm or not.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[cfg(target_arch = </span><span class="token attribute attr-name string" style="color:#e3116c">"wasm32"</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">foo_for_wasm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[cfg(not(target_arch = </span><span class="token attribute attr-name string" style="color:#e3116c">"wasm32"</span><span class="token attribute attr-name" style="color:#00a4db">))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">foo_for_generic_arch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, conditional compilation has some drawbacks. First of all, it’s a little verbose, which hurts code readability. You can see in the example above that the function <code>foo</code> is “noisier” than it would be if not for the extra conditional compilation annotations. Secondly, IDEs do not handle conditional compilation especially well. They will only analyze one branch of the code at a time, and it is a little tedious to switch between which target you are asking the IDE to check.</p>
<p>Fortunately, we do not need to use conditional compilation very much because we can adopt coding style patterns from functional programming. The key idea is to write code that is abstract with respect to the implementation of target-specific effects such as reading/writing state. In Rust, we can accomplish this using traits and type generics.</p>
<h3 class="anchor anchorWithStickyNavbar_L_jL" id="traits-and-type-generics">Traits and Type Generics<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#traits-and-type-generics" class="hash-link" aria-label="Direct link to Traits and Type Generics" title="Direct link to Traits and Type Generics">​</a></h3>
<p>Rust’s trait defines an interface. It gives the type signatures of the methods a type implementing that trait must have, but does not necessarily specify the implementation of those methods (though you are allowed to give a default implementation of a method in a trait). Consider the following example:</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> </span><span class="token type-definition class-name">IO</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u8</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">get_balance</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u128</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">u128</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from_be_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">r</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This example includes a trait with a (simplified) interface for interacting with state as well as a function with a generic type parameter. The syntax means “this function accepts any type so long as it implements <code>IO</code> the interface”. The benefit of coding in this style is that the <code>get_balance</code> function can now be reused in any program, regardless of what compilation target it uses, so long as there is an <code>IO</code> implementation for it. This is exactly what enables us to share a codebase between our smart contract and indexer.</p>
<p>In this example above, it might seem like we are going through a lot of trouble to reuse one line of code in two different places. But this approach scales. The function we share does not need to be only a single line, it could have any amount of complexity.</p>
<p>Moreover, state access is not the only target-specific effect. We can have traits for accessing environment variables (in the blockchain context, these would be variables like the current block height, the signer of the transaction, etc) and interacting with other processes (in the blockchain context, this corresponds to calling other smart contracts).</p>
<p>Beyond reusability, there are other benefits to coding in this style. Code written in this way is easier to test because you can simulate the effects in-memory (for example, instead of actually reading and writing files). It is also easier to reason about this style of code. When there are no side-effects, the function signature gives you all the information you need about the function.</p>
<p>If a function needs access to state, then you know it will include the <code>IO</code> trait bound, and conversely, if the state is not needed, then it will not include that bound. When you can learn so much about a function without reading its implementation body, it becomes much easier to navigate the codebase.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="application-aurora-engine">Application: Aurora Engine<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#application-aurora-engine" class="hash-link" aria-label="Direct link to Application: Aurora Engine" title="Direct link to Application: Aurora Engine">​</a></h2>
<p>The entire Aurora Engine is written in this style. For example, <a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine/src/engine.rs#L1280" target="_blank" rel="noopener noreferrer"><em>here</em></a> is the real version of the <code>get_balance</code> function we showed a toy example of above. And similarly, there is a <code>set_balance</code> <a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine/src/engine.rs#L1269" target="_blank" rel="noopener noreferrer"><em>function</em></a>. These two functions are composed together to make an <code>add_balance</code> <a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine/src/engine.rs#L1258" target="_blank" rel="noopener noreferrer"><em>function</em></a>.</p>
<div class="language-rust codeBlockContainer_N8ub theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_aLV6"><pre tabindex="0" class="prism-code language-rust codeBlock_hirX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_WzCr"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">get_balance</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Wei</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> raw </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_u256</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token function" style="color:#d73a49">address_to_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">KeyPrefix</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unwrap_or_else</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">_</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">U256</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">raw</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">set_balance</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write_storage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token function" style="color:#d73a49">address_to_key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">KeyPrefix</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">balance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">add_balance</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IO</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    io</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">I</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Wei</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">BalanceOverflow</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> current_balance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_balance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> new_balance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current_balance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checked_add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok_or</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BalanceOverflow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set_balance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">new_balance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_YzQc"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JSbB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ilDU"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_pqXq"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see the implementation of the <code>IO</code> trait for both the <a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine-sdk/src/near_runtime.rs#L128" target="_blank" rel="noopener noreferrer"><em>Near Runtime</em></a>, and the “<a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine-standalone-storage/src/engine_state.rs#L82" target="_blank" rel="noopener noreferrer"><em>standalone engine</em></a>” which uses a <code>rocksdb</code> instance to persist the state.</p>
<p>The former is used in the Wasm artifact, which is deployed to Near as the Aurora Engine smart contract. The standalone engine is used to <a href="https://github.com/aurora-is-near/borealis-engine-lib/blob/v0.23.4/refiner-app/src/socket.rs#L129" target="_blank" rel="noopener noreferrer"><em>implement the eth_estimateGas RPC method</em></a>, and the state is populated by <a href="https://github.com/aurora-is-near/aurora-engine/blob/2.10.2/engine-standalone-storage/src/sync/mod.rs#L229" target="_blank" rel="noopener noreferrer"><em>consuming Near blocks</em></a> (from <a href="https://github.com/aurora-is-near/borealis-engine-lib/tree/v0.23.4#near-data-lake" target="_blank" rel="noopener noreferrer"><em>Near data lake for example</em></a>).</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="conclusion">Conclusion<a href="https://doc.aurora.dev/blog/turning-smart-contracts-into-indexers#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The take-home message from this post is that following the functional programming pattern of only writing business logic using abstractions of target-specific effects such as IO results in code that is easier to test, maintain, and reuse. In the particular case of Aurora, that reuse manifests as having the Aurora Engine smart contract and the indexer that serves the Aurora RPC share a codebase.</p>]]></content>
        <author>
            <name>Michael Birch</name>
        </author>
        <category label="Tutorials" term="Tutorials"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to get USDC tokens on Aurora testnet]]></title>
        <id>https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet</id>
        <link href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet"/>
        <updated>2023-07-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[While developing your smart contracts on Aurora, there are situations when you will need to get native Ethereum ERC-20 tokens on your testnet account – let’s find out how to get these by using the USDC token as an example]]></summary>
        <content type="html"><![CDATA[<p>When you develop a contract, quite often you need ERC-20 tokens for testing. If your contract is rather small and doesn't use cross-contract calls, most likely, you don't need official USDC tokens or any other specific tokens. In that case, the best solution is just to take the standard ERC-20 contract, deploy it, and mint as many test tokens as you wish.</p>
<p>However, sometimes the easier solution for testing can be to get official testing tokens. For example, if your contract is use difficult cross-contract calls and dependencies contracts are already deployed on testnet and support only limited numbers of tokens. When I am testing RainbowBridge during development I use the USDC tokens on testnet.</p>
<p>In this article, I will explain how to get official native Ethereum ERC-20 tokens on your Aurora testnet account in the example of USDC tokens. This method will work with other popular native Ethereum ERC-20 as well, and it will be clear how to get these tokens also in Goerli Ethereum and in Near testnet.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="plan-for-getting-usdc-tokens-on-aurora-testnet">Plan for getting USDC tokens on Aurora testnet<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#plan-for-getting-usdc-tokens-on-aurora-testnet" class="hash-link" aria-label="Direct link to Plan for getting USDC tokens on Aurora testnet" title="Direct link to Plan for getting USDC tokens on Aurora testnet">​</a></h2>
<p>For getting USDC tokens, we're going to use the following plan:</p>
<ol>
<li>Create an account in MetaMask for the Ethereum Goerli network and Aurora testnet</li>
<li>Mint Ether for your Ethereum account</li>
<li>Swap Ether to the USDC tokens in the Ethereum network</li>
<li>Transfer USDC tokens from Ethereum to Aurora by using Rainbow Bridge</li>
</ol>
<p>The instructions for steps 1 and 2 you can find in article <a href="https://doc.aurora.dev/blog/getting-started-with-aurora">"Getting started with Aurora"</a>, so I will not describe them here. For the 1 step see section "Creating an account on the Aurora testnet using MetaMask", for the 2 step see section "Obtaining AuroraEth on the testnet" -&gt; "The second method: transfer from Ethereum".</p>
<p>I assume that you already have an account in MetaMask for both Goerli Ethereum network and Aurora testnet and also you have some Ether in Goerli Ethereum network.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="usdc-tokens-accounts">USDC tokens accounts<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#usdc-tokens-accounts" class="hash-link" aria-label="Direct link to USDC tokens accounts" title="Direct link to USDC tokens accounts">​</a></h2>
<p>There can be a large number of accounts for USDC on the testnets. Moreover, you can take a USDC token contract and deploy it on your own. We are interested in the official deployment of USDC tokens on Goerli Ethereum and the official wrappers of this token on Aurora and Near.</p>
<p>Official USDC address on Goerli Ethereum: <a href="https://goerli.etherscan.io/token/0x07865c6e87b9f70255377e024ace6630c1eaa37f" target="_blank" rel="noopener noreferrer">0x07865c6E87B9F70255377e024ace6630C1Eaa37F</a></p>
<p>For search the addresses on the Near and Aurora testnet networks and check that address is supported by Rainbow Bridge you can go to <a href="https://testnet.rainbowbridge.app/deploy" target="_blank" rel="noopener noreferrer">https://testnet.rainbowbridge.app/deploy</a> , write the address of the USDC token in the search and click the <code>Find Token</code> button:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544553-screenshot-2023-07-28-at-12-40-45.png" alt="" class="img__pfF"></p>
<p>You will see the query result:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690545689-screenshot-2023-07-28-at-13-01-18.png" alt="" class="img__pfF"></p>
<p>As we can see from the image above, the address on the NEAR is: <code>07865c6e87b9f70255377e024ace6630c1eaa37f.factory.goerli.testnet</code></p>
<p>And the address on the Aurora is: <code>0x901fb725c106e182614105335ad0e230c91b67c8</code></p>
<p><strong>WARNING:</strong> Some sites can mint USDC tokens, but with a different address, so you need to double-check the address of minted tokens.</p>
<p>This <a href="https://github.com/aurora-is-near/bridge-assets/tree/master/tokens" target="_blank" rel="noopener noreferrer">repo</a> also contains the list of tokens supported by the Rainbow Bridge, however this list is not full for the testnets, for example, the USDC tokens are not included.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="get-usdc-token-on-ethereum">Get USDC token on Ethereum<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#get-usdc-token-on-ethereum" class="hash-link" aria-label="Direct link to Get USDC token on Ethereum" title="Direct link to Get USDC token on Ethereum">​</a></h2>
<p>We have the Goerli Ethereum account and some GoerliETH. Let’s exchange some Ether for USDC tokens! For swapping, we're going to use Uniswap.</p>
<p><strong>1. Open Uniswap site:</strong> <a href="https://app.uniswap.org/#/swap" target="_blank" rel="noopener noreferrer">https://app.uniswap.org/#/swap</a></p>
<p><strong>2. Connect to Goerli Network.</strong> It can look like it doesn’t support testnet network, but it actually support it, just it is not clear from the web interface.</p>
<ul>
<li>Click the <code>Connect</code> button. Choose MetaMask and connect to your account.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1689675168-uniswapconnect.jpg" alt="" class="img__pfF"></p>
<ul>
<li>Switch on <code>Show testnets</code> option on the Uniswap site:</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544253-screenshot-2023-07-28-at-12-35-32.png" alt="" class="img__pfF"></p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544262-screenshot-2023-07-28-at-12-35-41.png" alt="" class="img__pfF"></p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544274-screenshot-2023-07-28-at-12-35-54.png" alt="" class="img__pfF"></p>
<ul>
<li>Change the network to Goerli Testnet.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544545-screenshot-2023-07-28-at-12-39-49.png" alt="" class="img__pfF"></p>
<p><strong>3. Swap GoerliEth into USDC:</strong></p>
<ul>
<li>Click <code>Select token</code>. Yes, you doesn’t see the USDC tokens in the list. It is Ok, don’t worry:</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544771-screenshot-2023-07-28-at-12-45-29.png" alt="" class="img__pfF"></p>
<p>In the search field write <code>USDC</code> and select the <code>USD Coin</code> from the list. For some tokens, even searching by the token's name doesn't help. In that case, try to use the <strong>token's address</strong> in the search.</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544783-screenshot-2023-07-28-at-12-45-51.png" alt="" class="img__pfF"></p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544794-screenshot-2023-07-28-at-12-45-57.png" alt="" class="img__pfF"></p>
<ul>
<li>Put some small amount of ETH in first line. 0.01 GöETH will be enough.</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544849-screenshot-2023-07-28-at-12-44-59.png" alt="" class="img__pfF"></p>
<ul>
<li>Click Swap</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544873-screenshot-2023-07-28-at-12-45-06.png" alt="" class="img__pfF"></p>
<p>Congratulations! Now you get a lot of test USDC in your Ethereum account. You can check, that you receive tokens in MetaMask and check the address of the received tokens. If you don’t see the USDC tokens click "Import tokens" in MetaMask and put the address of USDC token.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="transfer-usdc-tokens-to-aurora">Transfer USDC tokens to Aurora<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#transfer-usdc-tokens-to-aurora" class="hash-link" aria-label="Direct link to Transfer USDC tokens to Aurora" title="Direct link to Transfer USDC tokens to Aurora">​</a></h2>
<p>Now the easy part: transfer USDC tokens from Ethereum to Aurora.</p>
<ul>
<li>Open the Rainbow Bridge for testnet: <a href="https://testnet.rainbowbridge.app/" target="_blank" rel="noopener noreferrer">https://testnet.rainbowbridge.app/</a></li>
<li>Click New Transfer:</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690544972-screenshot-2023-07-28-at-12-48-40.png" alt="" class="img__pfF"></p>
<ul>
<li>Connect to your accounts on Ethereum and on Aurora:</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690545004-screenshot-2023-07-28-at-12-48-57.png" alt="" class="img__pfF"></p>
<p>And now, choose USDC.e tokens and amount for transferring, and click <code>Continue</code>:</p>
<p><img decoding="async" loading="lazy" src="https://www.datocms-assets.com/95026/1690545027-screenshot-2023-07-28-at-12-49-11.png" alt="" class="img__pfF"></p>
<p>Done! Now you need to wait <em>20 minutes</em> before you get your test USDC on Aurora.</p>
<p><em>Remark</em>: you also can transfer the USDC tokens or other tokens to your Near accounts in the same way.</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="conclusion">Conclusion<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In this short article, we learned how to get a lot of USDC tokens on Ethereum, Near and Aurora. This method is also applicable to other popular Ethereum ERC-20 tokens. Now you can use these tokens to test your contracts. Happy development and testing!</p>
<h2 class="anchor anchorWithStickyNavbar_L_jL" id="references">References<a href="https://doc.aurora.dev/blog/how-to-get-usdc-tokens-on-aurora-testnet#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li>Article with instructions on how to install MetaMask and mint Ether: <a href="https://doc.aurora.dev/blog/getting-started-with-aurora">/blog/getting-started-with-aurora</a></li>
<li>USDC tokens address on Ethereum Goerli: <a href="https://goerli.etherscan.io/address/0x07865c6e87b9f70255377e024ace6630c1eaa37f" target="_blank" rel="noopener noreferrer">https://goerli.etherscan.io/address/0x07865c6e87b9f70255377e024ace6630c1eaa37f</a></li>
<li>Uniswap: <a href="https://app.uniswap.org/#/swap" target="_blank" rel="noopener noreferrer">https://app.uniswap.org/#/swap</a></li>
<li>Rainbow Bridge For Testnet: <a href="https://testnet.rainbowbridge.app/" target="_blank" rel="noopener noreferrer">https://testnet.rainbowbridge.app/</a></li>
<li>Checking the supported tokens for Rainbow Bridge on Testnet: <a href="https://testnet.rainbowbridge.app/deploy" target="_blank" rel="noopener noreferrer">https://testnet.rainbowbridge.app/deploy</a></li>
</ul>]]></content>
        <author>
            <name>Olga Kunyavskaya</name>
        </author>
        <category label="Tips & Tricks" term="Tips & Tricks"/>
    </entry>
</feed>